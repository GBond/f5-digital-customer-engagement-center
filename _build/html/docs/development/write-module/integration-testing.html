<!DOCTYPE html>
<div id="clouddocs-header">
  <div class="container-fluid">
    <div class="row corp-header">
      <div class="container corp-header">
        <div class="container corp-menu">
          <ul>
            <li><a href="https://f5.com" class="internalLink">F5.com</a></li>
            <li><a href="https://github.com/F5Networks" class="externalLink">GitHub</a></li>
            <li><a href="https://devcentral.f5.com" class="internalLink">Devcentral</a></li>
            <li><a href="https://support.f5.com" class="internalLink">Support</a></li>
          </ul>
        </div>
      </div>
    </div>

    <script async="async"
      src="https://consent.trustarc.com/notice?domain=f5.com&amp;c=teconsent&amp;text=true&amp;gtm=1" crossorigin=""
      id="truste_0.12182038258598205"></script>

    <div class="row pageHeader">
      <div class="container stat">
        <div class="col-xs-12 stat">
          <a class="internalLink" href="https://f5.com">
            <img class="logo" src="https://cdn.f5.com/websites/support/assets/images/logo.svg" width="50" height="44"
              alt="F5 Networks" title="F5 Networks" border="0">
          </a>
          <ul id="MainMenu" class="main-menu">
            <li data-submenu-id="products">
              <a data-link-type="nav: main" href="#" class="currentURL">Products
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="products-submenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h">BIG-IP Extensibility</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-extension/latest" data-link-type="Nav: Mega">F5
                            Application Services Extension 3</a></li>
                        <li><a href="https://clouddocs.f5.com/products/agc/latest" data-link-type="Nav: Mega">BIG-IP APM Access Guided
                            Configuration</a></li>
                        <li><a href="https://clouddocs.f5.com/products/iapp/iapp-lx/latest" data-link-type="Nav: Mega">iApps LX/iControl LX</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-declarative-onboarding/latest"
                            data-link-type="Nav: Mega">F5 Declarative Onboarding</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-telemetry-streaming/latest" data-link-type="Nav: Mega">F5
                            Telemetry Streaming</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-cloud-failover/latest" data-link-type="Nav: Mega">F5 Cloud
                            Failover</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-templates/latest/" data-link-type="Nav: Mega">F5
                            Application Services Templates</a></li>
                      </ul>
                    </li>


                    <li class="divider"></li>
                    <li><span class="a-mm-h">Container Ingress Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/" data-link-type="Nav: Mega">F5 BIG-IP Controller for
                            Kubernetes/OpenShift</a></li>
                      </ul>
                      <span class="a-mm-h">Network Function Virtualization</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/nfv/latest" data-link-type="Nav: Mega">F5 VNF Manager</a></li>
                      </ul>
                      <span class="a-mm-h">SDK</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-cli" target="_blank">F5 CLI</a></li>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-sdk-python" target="_blank">F5 SDK Python</a></li>
                      </ul>
                    </li>



                    <li class="divider"></li>
                    <li>
                      <span class="a-mm-h">OpenStack</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/openstack/agent/latest" data-link-type="Nav: Mega">F5 Agent - OpenStack
                            Neutron</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/lbaasv2-driver/latest" data-link-type="Nav: Mega">F5 Driver -
                            OpenStack LBaaS</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/heat-plugins/latest" data-link-type="Nav: Mega">F5 Plugins -
                            OpenStack Heat</a></li>
                      </ul>

                      <span class="a-mm-h">Ecosystems Integrations</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/f5-aci-servicecenter/latest" data-link-type="Nav: Mega">F5 ACI ServiceCenter</a>
                        </li>
                      </ul>


                    </li>
                    <li class="divider"></li>
                    <li><span class="a-mm-h">Orchestration</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/ansible/devel" target="_blank">F5 Modules for Ansible</a>
                        </li>
                        <li><a href="https://github.com/F5Networks/f5-aws-cloudformation" target="_blank"
                            class="externalLink">F5 Templates for AWS CloudFormation</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-azure-arm-templates" target="_blank"
                            class="externalLink">F5 Templates for Azure ARM</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-google-gdm-templates" target="_blank"
                            class="externalLink">F5 Templates for Google Cloud Deployment Manager</a> (GitHub)</li>
                        <li><a href="https://clouddocs.f5.com/products/templates/openstack-heat/latest" data-link-type="Nav: Mega">F5 Templates
                            for OpenStack Heat</a></li>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/terraform/latest/" data-link-type="Nav: Mega">F5 Resources
                            for Terraform Provider</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>

            <!--- NEW -->
            <li>
              <a href="#" class="currentURL">APIs
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="APISubmenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/big-iq/mgmt-api/latest/" data-link-type="Nav: Mega">F5 BIG-IQ API</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/api/iapps/">F5 BIG-IP iApps</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules">F5 BIG-IP iRules API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules-lx">F5 BIG-IP iRulesLX API</a></li>
                      </ul>
                    </li>

                    <li class="divider"></li>

                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-rest">F5 BIG-IP iControlREST API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-soap/">F5 BIG-IP iControl API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/ihealth/">F5 iHealth API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/tmsh">F5 tmsh scripting API</a></li>
                      </ul>
                    </li>

                  </ul>
                </div>
              </div>
            </li>




            <li>
              <a href="#" class="currentURL">Cloud &amp; Container
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="ContainersSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third"><span class="a-mm-h">Cloud Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GS-About.html"
                            data-link-type="Nav: Mega">Get Started</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Beacon-About.html"
                            data-link-type="Nav: Mega">Beacon</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-DNS-About.html"
                            data-link-type="Nav: Mega">DNS Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GSLB-About.html"
                            data-link-type="Nav: Mega">DNS Load Balancer Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Essential.App.Protect-About.html"
                            data-link-type="Nav: Mega">Essential App Protect Service</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Clouds</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/aws_index.html" data-link-type="Nav: Mega">AWS</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/azure_index.html" data-link-type="Nav: Mega">Azure</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/google_index.html" data-link-type="Nav: Mega">Google Cloud</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/cloud/openstack/" data-link-type="Nav: Mega">OpenStack</a></li>
                      </ul>
                      <!-- unnecessary right now>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/cloud/">See all </a></span>
                    <-->
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Containers</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/kubernetes/" data-link-type="Nav: Mega">Kubernetes</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/openshift/" data-link-type="Nav: Mega">OpenShift</a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li>
              <a href="#" class="currentURL">Resources
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="UPCProgramSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third">
                      <span class="a-mm-h">Downloads</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://hub.docker.com/r/f5networks/"
                            class="internalLink externalLink">Docker Hub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega"
                            href="https://store.docker.com/images/f5networks-asp"
                            class="internalLink externalLink">Docker Store</a></li>
                      </ul>
                      <span class="a-mm-h">OpenSource</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5Networks"
                            class="internalLink externalLink">F5Networks on GitHub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5DevCentral"
                            class="internalLink externalLink">F5DevCentral on GitHub</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third">
                      <span class="a-mm-h">Training &amp; Labs</span>
                      <ul>
                        <li>
                          <p>Learn how to get the most out of the F5 platform</p>
                        </li>
                        <li><a href="https://clouddocs.f5.com/training/community">Community</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>

                    <li class="third">
                      <a href="//university.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega">F5 University</a>
                      <ul>
                        <li>
                          <p>Get up to speed with free self-paced courses</p>
                        </li>
                      </ul>
                      <a data-ng-href="https://devcentral.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega" href="https://devcentral.f5.com">DevCentral</a>
                      <ul>
                        <li>
                          <p>Join the community of 250,000+ technical peers</p>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="col-xs-12 stat">
          <div class="topLinks">
            <span class="glyphicon glyphicon-search upc-search" id="search-toggle" style="display: none;"></span>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- /container-fluid -->
</div>
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Integration/Functional tests &#8212; F5 Digital Customer Engagement Center 0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="dismiss">
      <button type="button" class="btn btn-info navbar-btn site-hidden">
        <i class="fa fa-align-justify"></i>
      </button>
    </div>
    <div id="sidebar" class="section-nav">
      
      <nav class="nav-sidebartoc">

        
        <h5>F5 Digital Customer Engagement Center 0.1 </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <h5>Current Page</h5>
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Integration/Functional tests</a><ul>
<li><a class="reference internal" href="#structure-of-tests">Structure of tests</a><ul>
<li><a class="reference internal" href="#the-playbook">The playbook</a></li>
<li><a class="reference internal" href="#the-role">The role</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-content">Test content</a></li>
<li><a class="reference internal" href="#test-variables">Test variables</a></li>
<li><a class="reference internal" href="#calling-the-test">Calling the test</a></li>
<li><a class="reference internal" href="#including-supplementary-information">Including supplementary information</a></li>
<li><a class="reference internal" href="#other-testing-notes">Other testing notes</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

         </span>
        <hr>
        <h5>Site Contents</h5>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/getting_started.html">Getting started</a></li>
</ul>
<p class="caption"><span class="caption-text">Solutions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/delivery/delivery_index.html">Application Delivery controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/security/security_index.html">Security</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-involved.html">How to get involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">Guidelines</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>

  
  <div class="main active" id="content">
    <article class="docs-container site-article-inner">
            <nav class="site-breadcrumb-nav site-nav">
          <ul class="site-breadcrumb-list">
            <li class="breadcrumb-item"><button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn site-hidden"><i class="fa fa-align-justify"></i></button>&#x20 <a href="/">CloudDocs Home</a> &gt; <a href="../../../index.html">F5 Digital Customer Engagement Center </a> &gt; Integration/Functional tests</li>
          </ul>
      </nav>
      

    
  <div class="section" id="integration-functional-tests">
<h1>Integration/Functional tests<a class="headerlink" href="#integration-functional-tests" title="Permalink to this headline">¶</a></h1>
<p>This is probably the most important part of testing.</p>
<p>When you submit your module, you must submit functional tests, so that you and F5 can agree
that a module works on a particular platform.</p>
<p>When you submit a new PR, F5 will test your module on a variety of versions automatically, and
will provide feedback if issues exist.</p>
<div class="section" id="structure-of-tests">
<h2>Structure of tests<a class="headerlink" href="#structure-of-tests" title="Permalink to this headline">¶</a></h2>
<p>When you stub a new module, test file stubs are automatically created. There are several parts to
these stubs, and ultimately to the integration tests. All integration tests are composed of plain-old
Ansible features and components.</p>
<ul class="simple">
<li><p>A Playbook</p></li>
<li><p>A Role</p></li>
<li><p>Files</p></li>
<li><p>Templates</p></li>
<li><p>Inventory</p></li>
</ul>
<div class="section" id="the-playbook">
<h3>The playbook<a class="headerlink" href="#the-playbook" title="Permalink to this headline">¶</a></h3>
<p>All integration tests begin their life in the <code class="docutils literal notranslate"><span class="pre">Playbook</span></code>. The Playbook used by the tests is a regular
Playbook that you might find in regular Ansible deployments. For the module being developed, <a class="reference external" href="https://github.com/F5Networks/f5-ansible/blob/devel/test/integration/bigip_policy_rule.yaml">here is the
Playbook that is used</a>.</p>
<p>As might be expected, this Playbook has all the components of a “normal” Playbook. It specifies hosts,
has a name, declares variables, and includes a Role.</p>
<p>The Playbook and its contents are shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Test</span> <span class="n">the</span> <span class="n">bigip_policy_rule</span> <span class="n">module</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="s2">&quot;f5-test[0]&quot;</span>
  <span class="n">connection</span><span class="p">:</span> <span class="n">local</span>
  <span class="n">any_errors_fatal</span><span class="p">:</span> <span class="n">true</span>

  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">limit_to</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span>
    <span class="n">__metadata__</span><span class="p">:</span>
      <span class="n">version</span><span class="p">:</span> <span class="mf">1.0</span>
      <span class="n">tested_platforms</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">NA</span>
      <span class="n">callgraph_exclude</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">pycallgraph</span><span class="o">.*</span>

        <span class="c1"># Ansible related</span>
        <span class="o">-</span> <span class="n">ansible</span><span class="o">.</span><span class="n">module_utils</span><span class="o">.</span><span class="n">basic</span><span class="o">.</span><span class="n">AnsibleModule</span><span class="o">.*</span>
        <span class="o">-</span> <span class="n">ansible</span><span class="o">.</span><span class="n">module_utils</span><span class="o">.</span><span class="n">basic</span><span class="o">.*</span>
        <span class="o">-</span> <span class="n">ansible</span><span class="o">.</span><span class="n">module_utils</span><span class="o">.</span><span class="n">parsing</span><span class="o">.*</span>
        <span class="o">-</span> <span class="n">ansible</span><span class="o">.</span><span class="n">module_utils</span><span class="o">.</span><span class="n">_text</span><span class="o">.*</span>
        <span class="o">-</span> <span class="n">ansible</span><span class="o">.</span><span class="n">module_utils</span><span class="o">.</span><span class="n">six</span><span class="o">.*</span>

  <span class="n">environment</span><span class="p">:</span>
    <span class="n">F5_SERVER</span><span class="p">:</span> <span class="s2">&quot;{{ ansible_host }}&quot;</span>
    <span class="n">F5_USER</span><span class="p">:</span> <span class="s2">&quot;{{ bigip_username }}&quot;</span>
    <span class="n">F5_PASSWORD</span><span class="p">:</span> <span class="s2">&quot;{{ bigip_password }}&quot;</span>
    <span class="n">F5_SERVER_PORT</span><span class="p">:</span> <span class="s2">&quot;{{ bigip_port }}&quot;</span>
    <span class="n">F5_VALIDATE_CERTS</span><span class="p">:</span> <span class="s2">&quot;{{ validate_certs }}&quot;</span>

  <span class="n">roles</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">bigip_policy_rule</span>
</pre></div>
</div>
<p>Because most of this is a normal Playbook, this tutorial will just cover the parts that are interesting.</p>
<p>The first interesting bit is the large <code class="docutils literal notranslate"><span class="pre">vars</span></code> section. Frankly speaking, this can be ignored by
most contributors as it is not something that is used by the functional tests directly. Its
purpose is to provide metadata to the module developers for use in tracking testing and things.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">limit_to</span></code></p></td>
<td><ul class="simple">
<li><p>Not currently used</p></li>
<li><p>In the future, this var may allow you to select the tests that you want to run.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__metadata__</span></code></p></td>
<td><ul class="simple">
<li><p>Special variable used by F5 only to track F5-specific interests.</p></li>
<li><p>Playbook metadata versions are described more <a class="reference internal" href="../playbook-metadata.html"><span class="doc">in this document</span></a>.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">environment</span></code> section is also interesting in the context of the F5 modules. The modules support
specifying common connection parameters in the environment like this so that you do not need to specify
them in each task. To keep the size of the tasks small, the developers use this method.</p>
</div>
<div class="section" id="the-role">
<h3>The role<a class="headerlink" href="#the-role" title="Permalink to this headline">¶</a></h3>
<p>The Role contains all of the tests that will be run as part of the integration test suite.
Roles are written, and use all the same conventions, that normal Ansible Roles use.</p>
<p>Roles for integration tests can be found in the <code class="docutils literal notranslate"><span class="pre">targets</span></code> directory, right alongside the test
Playbook. Inside this directory are sub-directories. Each is named after the module under test.</p>
<p>For the purposes of this tutorial, the <a class="reference external" href="https://github.com/F5Networks/f5-ansible/tree/devel/test/integration/targets/bigip_policy_rule">Role directory can be found here</a>.</p>
<p>This role has everything you would associate with a normal role in Ansible.</p>
<ul class="simple">
<li><p>If your test requires static files, then a <code class="docutils literal notranslate"><span class="pre">files/</span></code> directory should be in your role.</p></li>
<li><p>If your test requires template data (for example, iRules) for its input, then a <code class="docutils literal notranslate"><span class="pre">templates/</span></code>
directory should be in your role.</p></li>
<li><p>All roles will perform some work to test the module, so a <code class="docutils literal notranslate"><span class="pre">tasks/</span></code> directory should be in
your role.</p></li>
</ul>
<p>When Ansible executes a role, it calls one file and one file only. That file is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tasks/main.yaml</span></code></p></li>
</ul>
<p>All integration tests will originate from this file.</p>
<p>Additional files that are commonly found in the <code class="docutils literal notranslate"><span class="pre">tasks/</span></code> directory alongside the
<code class="docutils literal notranslate"><span class="pre">main.yaml</span></code> file include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">setup.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">teardown.yaml</span></code></p></li>
</ul>
<p>These files, as their names suggest, are used for setting up the integration tests that
<em>will</em> run, and tearing down the integration tests that <em>have</em> run, respectively.</p>
<p>Now let’s dig in to what a test should look like.</p>
</div>
</div>
<div class="section" id="test-content">
<h2>Test content<a class="headerlink" href="#test-content" title="Permalink to this headline">¶</a></h2>
<p>The implementation for the functional tests related to the module being developed in this
tutorial <a class="reference external" href="https://github.com/F5Networks/f5-ansible/blob/devel/test/integration/targets/bigip_policy_rule/tasks/main.yaml">can be found here</a>.</p>
<p>The test itself will follow the pattern below.</p>
<ul class="simple">
<li><p>Perform some operation with the module</p></li>
<li><p>Assert a change (and optionally other values)</p></li>
<li><p>Perform the same operation again (identical)</p></li>
<li><p>Assert no change</p></li>
</ul>
<p>All of the tests work like this, and it is a decent smoke test for all modules.</p>
<p>Here is an example of a test from the module under development in this tutorial.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create rule for published policy, no actions, no conditions</span>
  <span class="nt">bigip_policy_rule</span><span class="p">:</span>
    <span class="nt">policy</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">policy_name1</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule1</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Assert Create rule for published policy, no actions, no conditions</span>
  <span class="nt">assert</span><span class="p">:</span>
    <span class="nt">that</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">result is changed</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create rule for published policy, no actions, no conditions - Idempotent check</span>
  <span class="nt">bigip_policy_rule</span><span class="p">:</span>
    <span class="nt">policy</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">policy_name1</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule1</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Assert Create rule for published policy, no actions, no conditions - Idempotent check</span>
  <span class="nt">assert</span><span class="p">:</span>
    <span class="nt">that</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">result is not changed</span>
</pre></div>
</div>
<p>All tests that change data should include a subsequent test that tries to perform the same test,
but whose result you do <em>not</em> expect to change.</p>
<p>These are idempotent tests because they ensure that the module only changes settings if needed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The test code itself is identical to the previous test. The test name includes the string
<code class="docutils literal notranslate"><span class="pre">&quot;-</span> <span class="pre">Idempotent</span> <span class="pre">check&quot;</span></code>. This gives reviewers the ability to visually note that this is an
idempotent test. Additionally, it allows them to call out this specific test if running
the Playbook with the <code class="docutils literal notranslate"><span class="pre">--start-at-task</span></code> argument.</p>
<p>The assertion checks that the result has <em>not</em> changed. This is the important part, because
it ensures that the test itself was idempotent.</p>
</div>
</div>
<div class="section" id="test-variables">
<h2>Test variables<a class="headerlink" href="#test-variables" title="Permalink to this headline">¶</a></h2>
<p>Information specific to the tests that you need to run should be in the <cite>defaults/main.yaml</cite>
file of your test role.</p>
<p>By putting them there, you allow individuals to override values in your test by providing
arguments to the CLI at runtime.</p>
</div>
<div class="section" id="calling-the-test">
<h2>Calling the test<a class="headerlink" href="#calling-the-test" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to run the tests. They are:</p>
<ul class="simple">
<li><p>Use a <code class="docutils literal notranslate"><span class="pre">make</span></code> command</p></li>
<li><p>Run the playbook directly</p></li>
</ul>
<p>The methods have different pros and cons depending on your objective. For those concerned
with developing modules, you will likely prefer the latter method: running playbooks directly.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 48%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Pros</p></th>
<th class="head"><p>Cons</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">make</span></code> command</p></td>
<td><ul class="simple">
<li><p>Not a lot to type</p></li>
<li><p>Commands available for all modules</p></li>
<li><p>Useful when verifying an otherwise known good test</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>No debug output</p></li>
<li><p>No ability to step through tests</p></li>
<li><p>No ability to start at specific tests</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Run Playbook</p></td>
<td><ul class="simple">
<li><p>Supports all Ansible commands</p></li>
<li><p>Supports skipping</p></li>
<li><p>Supports debug</p></li>
<li><p>Supports stepping</p></li>
<li><p>Supports specifying overriding arguments</p></li>
<li><p>Supports tag selection</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Requires more typing</p></li>
<li><p>Requires knowledge of Ansible commands</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Since this tutorial is interested in development of a module, it will use the “Run Playbook”
method.</p>
<p>To run the tests without <code class="docutils literal notranslate"><span class="pre">make</span></code>, first, change to the following directory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test/integration</span></code></p></li>
</ul>
<p>Next, find the playbook that matches the module you wish to test. Using this playbook, run
<cite>ansible-playbook</cite> as you normally would. A hosts file is provided in the <code class="docutils literal notranslate"><span class="pre">inventory</span></code> directory.</p>
<p>An example command might be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-playbook -i inventory/hosts bigip_policy_rule.yaml -vvvv --step
</pre></div>
</div>
<p>This is the most flexible option during debugging, and it is the recommended way to test the
modules.</p>
</div>
<div class="section" id="including-supplementary-information">
<h2>Including supplementary information<a class="headerlink" href="#including-supplementary-information" title="Permalink to this headline">¶</a></h2>
<p>If you include files inside of the <code class="docutils literal notranslate"><span class="pre">files/</span></code>, <code class="docutils literal notranslate"><span class="pre">templates</span></code>, or other directories in which the
content of that file was auto-generated or pulled from a third party source, you should
include a <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file in your role’s directory.</p>
<p>In this file, you can include steps to reproduce any of the input items that you include in
the role subdirectories.</p>
<p>In addition, this is a good location to include references to third-party file locations if
you have included them in the tests. For example, if you were to include iRules or other
things that you downloaded and included from DevCentral or similar.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">README.md</span></code> is there for future developers to reference the information needed to re-create
any of the inputs to your tests.</p>
</div>
<div class="section" id="other-testing-notes">
<h2>Other testing notes<a class="headerlink" href="#other-testing-notes" title="Permalink to this headline">¶</a></h2>
<p>When writing your tests, you <strong>should</strong> concern yourself with “undoing” what you have done
previously to the test environment.</p>
<p>The test environment boots harnesses for each suite of tests. This means that all tests run on
the same harness. Therefore, someone might accidentally use changes you made in one of the integration
tests as a basis for subsequent tests. This makes using the <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> previously mentioned
arguments (<code class="docutils literal notranslate"><span class="pre">--step</span></code>, <code class="docutils literal notranslate"><span class="pre">--start-at-task</span></code>, <code class="docutils literal notranslate"><span class="pre">--tags</span></code>, etc.) much more difficult.</p>
<p>Therefore, please clean up after yourself. Since you need to test the <code class="docutils literal notranslate"><span class="pre">absent</span></code> case in most
cases, this is a good opportunity to do that. The <code class="docutils literal notranslate"><span class="pre">teardown.yaml</span></code> file can also be used to
teardown any resources that were created to assist in testing your module.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>If you’ve made it this far, then give yourself a pat on the back. This officially concludes the
mainline tutorial concerning module development. At this point you should be much more familiar
with the parts that make up a module, as well as the assortment of supporting files for the
module.</p>
<p>Feel free to peruse the other development-related docs on the site, and keep an eye out for
future documents that detail more technical methods for development. Finally, since the
process of module development (and the conventions that are used) are continually changing,
be sure to frequently refer back to these pages for updates to your existing knowledge.</p>
</div>
</div>


    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../../_static/js/bootstrap.min.js"></script>
  <script src="../../../_static/js/clouddocs.js"></script>
  </body>
</html>