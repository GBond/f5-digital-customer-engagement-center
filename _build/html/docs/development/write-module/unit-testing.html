<!DOCTYPE html>
<div id="clouddocs-header">
  <div class="container-fluid">
    <div class="row corp-header">
      <div class="container corp-header">
        <div class="container corp-menu">
          <ul>
            <li><a href="https://f5.com" class="internalLink">F5.com</a></li>
            <li><a href="https://github.com/F5Networks" class="externalLink">GitHub</a></li>
            <li><a href="https://devcentral.f5.com" class="internalLink">Devcentral</a></li>
            <li><a href="https://support.f5.com" class="internalLink">Support</a></li>
          </ul>
        </div>
      </div>
    </div>

    <script async="async"
      src="https://consent.trustarc.com/notice?domain=f5.com&amp;c=teconsent&amp;text=true&amp;gtm=1" crossorigin=""
      id="truste_0.12182038258598205"></script>

    <div class="row pageHeader">
      <div class="container stat">
        <div class="col-xs-12 stat">
          <a class="internalLink" href="https://f5.com">
            <img class="logo" src="https://cdn.f5.com/websites/support/assets/images/logo.svg" width="50" height="44"
              alt="F5 Networks" title="F5 Networks" border="0">
          </a>
          <ul id="MainMenu" class="main-menu">
            <li data-submenu-id="products">
              <a data-link-type="nav: main" href="#" class="currentURL">Products
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="products-submenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h">BIG-IP Extensibility</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-extension/latest" data-link-type="Nav: Mega">F5
                            Application Services Extension 3</a></li>
                        <li><a href="https://clouddocs.f5.com/products/agc/latest" data-link-type="Nav: Mega">BIG-IP APM Access Guided
                            Configuration</a></li>
                        <li><a href="https://clouddocs.f5.com/products/iapp/iapp-lx/latest" data-link-type="Nav: Mega">iApps LX/iControl LX</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-declarative-onboarding/latest"
                            data-link-type="Nav: Mega">F5 Declarative Onboarding</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-telemetry-streaming/latest" data-link-type="Nav: Mega">F5
                            Telemetry Streaming</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-cloud-failover/latest" data-link-type="Nav: Mega">F5 Cloud
                            Failover</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-templates/latest/" data-link-type="Nav: Mega">F5
                            Application Services Templates</a></li>
                      </ul>
                    </li>


                    <li class="divider"></li>
                    <li><span class="a-mm-h">Container Ingress Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/" data-link-type="Nav: Mega">F5 BIG-IP Controller for
                            Kubernetes/OpenShift</a></li>
                      </ul>
                      <span class="a-mm-h">Network Function Virtualization</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/nfv/latest" data-link-type="Nav: Mega">F5 VNF Manager</a></li>
                      </ul>
                      <span class="a-mm-h">SDK</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-cli" target="_blank">F5 CLI</a></li>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-sdk-python" target="_blank">F5 SDK Python</a></li>
                      </ul>
                    </li>



                    <li class="divider"></li>
                    <li>
                      <span class="a-mm-h">OpenStack</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/openstack/agent/latest" data-link-type="Nav: Mega">F5 Agent - OpenStack
                            Neutron</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/lbaasv2-driver/latest" data-link-type="Nav: Mega">F5 Driver -
                            OpenStack LBaaS</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/heat-plugins/latest" data-link-type="Nav: Mega">F5 Plugins -
                            OpenStack Heat</a></li>
                      </ul>

                      <span class="a-mm-h">Ecosystems Integrations</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/f5-aci-servicecenter/latest" data-link-type="Nav: Mega">F5 ACI ServiceCenter</a>
                        </li>
                      </ul>


                    </li>
                    <li class="divider"></li>
                    <li><span class="a-mm-h">Orchestration</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/ansible/devel" target="_blank">F5 Modules for Ansible</a>
                        </li>
                        <li><a href="https://github.com/F5Networks/f5-aws-cloudformation" target="_blank"
                            class="externalLink">F5 Templates for AWS CloudFormation</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-azure-arm-templates" target="_blank"
                            class="externalLink">F5 Templates for Azure ARM</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-google-gdm-templates" target="_blank"
                            class="externalLink">F5 Templates for Google Cloud Deployment Manager</a> (GitHub)</li>
                        <li><a href="https://clouddocs.f5.com/products/templates/openstack-heat/latest" data-link-type="Nav: Mega">F5 Templates
                            for OpenStack Heat</a></li>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/terraform/latest/" data-link-type="Nav: Mega">F5 Resources
                            for Terraform Provider</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>

            <!--- NEW -->
            <li>
              <a href="#" class="currentURL">APIs
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="APISubmenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/big-iq/mgmt-api/latest/" data-link-type="Nav: Mega">F5 BIG-IQ API</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/api/iapps/">F5 BIG-IP iApps</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules">F5 BIG-IP iRules API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules-lx">F5 BIG-IP iRulesLX API</a></li>
                      </ul>
                    </li>

                    <li class="divider"></li>

                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-rest">F5 BIG-IP iControlREST API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-soap/">F5 BIG-IP iControl API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/ihealth/">F5 iHealth API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/tmsh">F5 tmsh scripting API</a></li>
                      </ul>
                    </li>

                  </ul>
                </div>
              </div>
            </li>




            <li>
              <a href="#" class="currentURL">Cloud &amp; Container
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="ContainersSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third"><span class="a-mm-h">Cloud Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GS-About.html"
                            data-link-type="Nav: Mega">Get Started</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Beacon-About.html"
                            data-link-type="Nav: Mega">Beacon</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-DNS-About.html"
                            data-link-type="Nav: Mega">DNS Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GSLB-About.html"
                            data-link-type="Nav: Mega">DNS Load Balancer Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Essential.App.Protect-About.html"
                            data-link-type="Nav: Mega">Essential App Protect Service</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Clouds</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/aws_index.html" data-link-type="Nav: Mega">AWS</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/azure_index.html" data-link-type="Nav: Mega">Azure</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/google_index.html" data-link-type="Nav: Mega">Google Cloud</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/cloud/openstack/" data-link-type="Nav: Mega">OpenStack</a></li>
                      </ul>
                      <!-- unnecessary right now>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/cloud/">See all </a></span>
                    <-->
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Containers</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/kubernetes/" data-link-type="Nav: Mega">Kubernetes</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/openshift/" data-link-type="Nav: Mega">OpenShift</a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li>
              <a href="#" class="currentURL">Resources
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="UPCProgramSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third">
                      <span class="a-mm-h">Downloads</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://hub.docker.com/r/f5networks/"
                            class="internalLink externalLink">Docker Hub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega"
                            href="https://store.docker.com/images/f5networks-asp"
                            class="internalLink externalLink">Docker Store</a></li>
                      </ul>
                      <span class="a-mm-h">OpenSource</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5Networks"
                            class="internalLink externalLink">F5Networks on GitHub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5DevCentral"
                            class="internalLink externalLink">F5DevCentral on GitHub</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third">
                      <span class="a-mm-h">Training &amp; Labs</span>
                      <ul>
                        <li>
                          <p>Learn how to get the most out of the F5 platform</p>
                        </li>
                        <li><a href="https://clouddocs.f5.com/training/community">Community</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>

                    <li class="third">
                      <a href="//university.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega">F5 University</a>
                      <ul>
                        <li>
                          <p>Get up to speed with free self-paced courses</p>
                        </li>
                      </ul>
                      <a data-ng-href="https://devcentral.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega" href="https://devcentral.f5.com">DevCentral</a>
                      <ul>
                        <li>
                          <p>Join the community of 250,000+ technical peers</p>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="col-xs-12 stat">
          <div class="topLinks">
            <span class="glyphicon glyphicon-search upc-search" id="search-toggle" style="display: none;"></span>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- /container-fluid -->
</div>
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unit Testing &#8212; F5 Digital Customer Engagement Center 0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="dismiss">
      <button type="button" class="btn btn-info navbar-btn site-hidden">
        <i class="fa fa-align-justify"></i>
      </button>
    </div>
    <div id="sidebar" class="section-nav">
      
      <nav class="nav-sidebartoc">

        
        <h5>F5 Digital Customer Engagement Center 0.1 </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <h5>Current Page</h5>
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Unit Testing</a><ul>
<li><a class="reference internal" href="#filesystem-location">Filesystem location</a></li>
<li><a class="reference internal" href="#tutorial-module-implementation">Tutorial module implementation</a></li>
<li><a class="reference internal" href="#general-things-to-know-about-unit-tests">General things to know about unit tests</a></li>
<li><a class="reference internal" href="#writing-a-unit-test">Writing a unit test</a><ul>
<li><a class="reference internal" href="#import-block">Import block</a></li>
<li><a class="reference internal" href="#fixture-setup">Fixture setup</a></li>
<li><a class="reference internal" href="#parameter-unit-tests">Parameter unit tests</a></li>
<li><a class="reference internal" href="#modulemanager-unit-tests">ModuleManager unit tests</a></li>
<li><a class="reference internal" href="#actual-tests">Actual tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

         </span>
        <hr>
        <h5>Site Contents</h5>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/getting_started.html">Getting started</a></li>
</ul>
<p class="caption"><span class="caption-text">Solutions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/delivery/delivery_index.html">Application Delivery controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/security/security_index.html">Security</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-involved.html">How to get involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">Guidelines</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>

  
  <div class="main active" id="content">
    <article class="docs-container site-article-inner">
            <nav class="site-breadcrumb-nav site-nav">
          <ul class="site-breadcrumb-list">
            <li class="breadcrumb-item"><button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn site-hidden"><i class="fa fa-align-justify"></i></button>&#x20 <a href="/">CloudDocs Home</a> &gt; <a href="../../../index.html">F5 Digital Customer Engagement Center </a> &gt; Unit Testing</li>
          </ul>
      </nav>
      

    
  <div class="section" id="unit-testing">
<h1>Unit Testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h1>
<p>Unit testing ensures that the general execution of the module code is correct. It is
the fastest way to test, requires no F5 products, and is what the developers recommended be used
when doing the initial development of a module.</p>
<p>While both forms of testing are important, the unit tests will not tell you if you have a fully
functioning module. Functional tests are the only things that can provide anything close to this
assurance. Nevertheless, unit tests are required by the F5 module developers. When contributing
code to upstream Ansible, only unit tests may be submitted to the core product. This is because
the Ansible developers do not have the ability to test F5 products.</p>
<div class="section" id="filesystem-location">
<h2>Filesystem location<a class="headerlink" href="#filesystem-location" title="Permalink to this headline">¶</a></h2>
<p>All unit tests are located in the following directory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tests/unit/</span></code></p></li>
</ul>
<p>Changing to this directory will show a number of files that are named after different modules.
For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-rw-r--r--    <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users    <span class="m">3507</span> Jan <span class="m">24</span> <span class="m">17</span>:20 test_bigip_config.py
-rw-r--r--    <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users    <span class="m">4138</span> Feb <span class="m">15</span> <span class="m">11</span>:21 test_bigip_configsync_action.py
-rw-r--r--    <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users   <span class="m">16007</span> Feb <span class="m">22</span> <span class="m">09</span>:27 test_bigip_data_group.py
-rw-r--r--    <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users   <span class="m">12692</span> Jan <span class="m">24</span> <span class="m">17</span>:20 test_bigip_device_connectivity.py
-rw-r--r--    <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users    <span class="m">4323</span> Jan <span class="m">24</span> <span class="m">17</span>:20 test_bigip_device_dns.py
-rw-r--r--    <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users    <span class="m">5547</span> Jan <span class="m">24</span> <span class="m">17</span>:20 test_bigip_device_group.py
</pre></div>
</div>
<p>These files are the unit test files themselves. The <code class="docutils literal notranslate"><span class="pre">test/unit/</span></code> directory also includes another
directory of interest:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fixtures/</span></code></p></li>
</ul>
<p>This directory contains a number of static data files that are used by the different unit tests.</p>
<p>As will be seen later during test development, the files in the <code class="docutils literal notranslate"><span class="pre">fixtures/</span></code> directory can be
easily loaded by using functions in the unit test file. Examples of fixture files are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-rw-r--r--  <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users     <span class="m">912</span> Nov <span class="m">14</span> <span class="m">19</span>:22 load_tm_sys_syslog.json
-rw-r--r--  <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users     <span class="m">893</span> Jan <span class="m">24</span> <span class="m">17</span>:20 load_tm_sys_ucs.json
-rw-r--r--  <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users     <span class="m">969</span> Nov <span class="m">14</span> <span class="m">19</span>:22 load_vcmp_guest.json
-rw-r--r--  <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users     <span class="m">808</span> Nov <span class="m">14</span> <span class="m">19</span>:22 load_vlan.json
-rw-r--r--  <span class="m">1</span> trupp  OLYMPUS<span class="se">\D</span>omain Users     <span class="m">510</span> Dec <span class="m">18</span> <span class="m">18</span>:37 load_vlan_interfaces.json
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fixture files are often in JSON format, because the REST API returns information in this format. Unit tests use these REST response payloads to verify the
tests’ correctness.</p>
</div>
</div>
<div class="section" id="tutorial-module-implementation">
<h2>Tutorial module implementation<a class="headerlink" href="#tutorial-module-implementation" title="Permalink to this headline">¶</a></h2>
<p>The implementation of the tutorial module’s unit tests <a class="reference external" href="https://github.com/F5Networks/f5-ansible/blob/stable-2.5/test/unit/test_bigip_policy_rule.py">can be found here</a>. Additionally, you
will need to have the following fixture files downloaded and placed in the <code class="docutils literal notranslate"><span class="pre">fixtures</span></code>
directory.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/F5Networks/f5-ansible/blob/stable-2.5/test/unit/fixtures/load_ltm_policy_draft_rule_http-uri_forward.json">load_ltm_policy_draft_rule_http-uri_forward.json</a></p></li>
</ul>
</div>
<div class="section" id="general-things-to-know-about-unit-tests">
<h2>General things to know about unit tests<a class="headerlink" href="#general-things-to-know-about-unit-tests" title="Permalink to this headline">¶</a></h2>
<p>Unit tests for the F5 Modules for Ansible are written using <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">pytest</span></code> to be able to run your unit tests, your tests <strong>must</strong> follow these rules.</p>
<ul class="simple">
<li><p>Classes, if used, must start with the string <code class="docutils literal notranslate"><span class="pre">Test</span></code>. Spelling must be exact.</p></li>
<li><p>Methods or functions containing tests must start with the string <code class="docutils literal notranslate"><span class="pre">test_</span></code>. Spelling must be
exact.</p></li>
<li><p>Unit tests do not need to do any form of cleanup. Pytest handles cleanup for you automatically.</p></li>
</ul>
</div>
<div class="section" id="writing-a-unit-test">
<h2>Writing a unit test<a class="headerlink" href="#writing-a-unit-test" title="Permalink to this headline">¶</a></h2>
<p>Let’s take the time now to write the unit tests for the module that was developed in this
tutorial. During the initial stubber run, the <code class="docutils literal notranslate"><span class="pre">f5ansible</span></code> command produced a unit test file that included a sampling of what will need to be done.</p>
<p>Let’s touch on those boilerplate blocks before investigating the actual testing code.</p>
<div class="section" id="import-block">
<h3>Import block<a class="headerlink" href="#import-block" title="Permalink to this headline">¶</a></h3>
<p>At the top of the unit test file (like at the top of many Python source code) there are a series
of <code class="docutils literal notranslate"><span class="pre">import</span></code> statements. These tell Python to include different bodies of code that come either
pre-installed with Python, or as separate packages that you should have installed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of the dependencies for typical F5 modules for Ansible are pre-installed for you in the
development Docker containers that were mentioned at the beginning of the tutorial.</p>
</div>
<p>Some of the imports of interest are:</p>
<ul class="simple">
<li><p>The SkipTest import</p></li>
<li><p>The dev versus prod import</p></li>
</ul>
<p>First, the <code class="docutils literal notranslate"><span class="pre">SkipTest</span></code> import. This import is defined as such:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nose.plugins.skip</span> <span class="kn">import</span> <span class="n">SkipTest</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">SkipTest</span><span class="p">(</span><span class="s2">&quot;F5 Ansible modules require Python &gt;= 2.7&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The purpose of this import is to declare that the F5 modules <strong>require</strong> Python versions
greater than, or equal to, 2.7. Over time, it is expected that this check will change to require
Python 3 and beyond. Therefore, be sure to keep aware of this and do not find yourself in a
situation where you are unable to upgrade either your operating system, or Python, to later
versions.</p>
<p>Next, the dev/prod import. This import is defined as such:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">library.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">Parameters</span>
    <span class="kn">from</span> <span class="nn">library.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ModuleParameters</span>
    <span class="kn">from</span> <span class="nn">library.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ApiParameters</span>
    <span class="kn">from</span> <span class="nn">library.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ModuleManager</span>
    <span class="kn">from</span> <span class="nn">library.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ArgumentSpec</span>
    <span class="kn">from</span> <span class="nn">library.module_utils.network.f5.common</span> <span class="kn">import</span> <span class="n">F5ModuleError</span>
    <span class="kn">from</span> <span class="nn">library.module_utils.network.f5.common</span> <span class="kn">import</span> <span class="n">iControlUnexpectedHTTPError</span>
    <span class="kn">from</span> <span class="nn">test.unit.modules.utils</span> <span class="kn">import</span> <span class="n">set_module_args</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">ansible.modules.network.f5.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">Parameters</span>
        <span class="kn">from</span> <span class="nn">ansible.modules.network.f5.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ModuleParameters</span>
        <span class="kn">from</span> <span class="nn">ansible.modules.network.f5.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ApiParameters</span>
        <span class="kn">from</span> <span class="nn">ansible.modules.network.f5.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ModuleManager</span>
        <span class="kn">from</span> <span class="nn">ansible.modules.network.f5.bigip_policy_rule</span> <span class="kn">import</span> <span class="n">ArgumentSpec</span>
        <span class="kn">from</span> <span class="nn">ansible.module_utils.network.f5.common</span> <span class="kn">import</span> <span class="n">F5ModuleError</span>
        <span class="kn">from</span> <span class="nn">ansible.module_utils.network.f5.common</span> <span class="kn">import</span> <span class="n">iControlUnexpectedHTTPError</span>
        <span class="kn">from</span> <span class="nn">units.modules.utils</span> <span class="kn">import</span> <span class="n">set_module_args</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SkipTest</span><span class="p">(</span><span class="s2">&quot;F5 Ansible modules require the f5-sdk Python library&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The purpose of this import block is the same as the purpose of a similar import block that
existed in the actual module code. The content in the <code class="docutils literal notranslate"><span class="pre">try</span></code> section attempts to import
development code (code in the f5-ansible Github repository) and if that fails, it will attempt
to load product code (code in the upstream Ansible Github repository).</p>
<p>This differentiation is used by the F5 module developers to allow for development out-of-band
of the upstream Ansible product.</p>
<p>Therefore, this import block serves a similar purpose to the module’s block. The major difference
is that the things that are imported are different. The unit test is interested in importing
the classes that are defined in the module. It will test these classes later.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is an ongoing disagreement among developers about what constitutes a “unit” for test.
F5 considers the “unit” under test <strong>the class</strong>, not <strong>the methods of the class</strong>.</p>
</div>
</div>
<div class="section" id="fixture-setup">
<h3>Fixture setup<a class="headerlink" href="#fixture-setup" title="Permalink to this headline">¶</a></h3>
<p>After the import block, the fixture setup block can be found. It is implemented like so.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fixture_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;fixtures&#39;</span><span class="p">)</span>
<span class="n">fixture_data</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">load_fixture</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fixture_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">fixture_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fixture_data</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">fixture_data</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>The first assignment in this block is used to declare two things:</p>
<ul class="simple">
<li><p>Where the fixtures can be found</p></li>
<li><p>A cache for the fixtures to prevent re-reads from disk</p></li>
</ul>
<p>After the assignment statements comes the definition of the <code class="docutils literal notranslate"><span class="pre">load_fixture</span></code> function. This
function is what is responsible for using the two assignments above.</p>
</div>
<div class="section" id="parameter-unit-tests">
<h3>Parameter unit tests<a class="headerlink" href="#parameter-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>The first set of unit tests that are stubbed (and the tests which are likely to be written
first) are the <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> class unit tests.</p>
<p>The parameters tests are typically defined by a class named <code class="docutils literal notranslate"><span class="pre">TestParameters</span></code>. The purpose of
this class is to test the different combinations of arguments that one can send to the different
parameter classes (<code class="docutils literal notranslate"><span class="pre">ApiParameters</span></code> and <code class="docutils literal notranslate"><span class="pre">ModuleParameters</span></code>).</p>
<p>Usually, you will provide the class an argument, and then assert that some property of the
<code class="docutils literal notranslate"><span class="pre">Parameters</span></code> class is equal to an expected value.</p>
<p>Using the module being developed as an example, refer to the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_module_parameters_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">policy</span><span class="o">=</span><span class="s1">&#39;Policy - Foo&#39;</span>
    <span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">ModuleParameters</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">policy</span> <span class="o">==</span> <span class="s1">&#39;Policy - Foo&#39;</span>
</pre></div>
</div>
<p>As stated previously, the test sets some property to some known value. It then creates an
instance of the <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> class under test–in this case <code class="docutils literal notranslate"><span class="pre">ModuleParameters</span></code>. It provides
the defined arguments to this class in the same way that the Ansible module does.</p>
<p>Finally, it performs an assertion to check that some expected <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> is equal to some
expected value.</p>
<p>All of the <code class="docutils literal notranslate"><span class="pre">Parameter</span></code> tests resemble this format.</p>
<p>There is no limit on the number of tests you are allowed to write. The general rule of thumb
is to follow code-coverage reports to determine what tests are missing.</p>
</div>
<div class="section" id="modulemanager-unit-tests">
<h3>ModuleManager unit tests<a class="headerlink" href="#modulemanager-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>The second set of unit tests that will be stubbed out are the <code class="docutils literal notranslate"><span class="pre">ModuleManager</span></code> tests. There
may be either a single class, or multiple classes, for testing the module manager(s). For
instance, if the Ansible module under test is a factory module (such as several GTM modules)
there may be two classes for module manager tests.</p>
<p>The basic definition of a <code class="docutils literal notranslate"><span class="pre">ModuleManager</span></code> test class is shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestManager</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ArgumentSpec</span><span class="p">()</span>
</pre></div>
</div>
<p>In the above stub, a method names <code class="docutils literal notranslate"><span class="pre">setUp</span></code> is defined. This is typical of all manager test
classes. The job of this method is to, (according to the <a class="reference external" href="https://docs.python.org/2/library/unittest.html">unittest documentation</a>)</p>
<p>…define instructions that will be executed before and after each test method</p>
<p>In this case, the unit tests will require an <code class="docutils literal notranslate"><span class="pre">ArgumentSpec</span></code> definition before they can run.
By putting this definition here, it can be used in all of the remaining unit tests in the class.</p>
</div>
<div class="section" id="actual-tests">
<h3>Actual tests<a class="headerlink" href="#actual-tests" title="Permalink to this headline">¶</a></h3>
<p>The actual unit tests of the <code class="docutils literal notranslate"><span class="pre">ModuleManager</span></code> should include (at a minimum) the following
tests:</p>
<ul class="simple">
<li><p>A creation test</p></li>
<li><p>An update test</p></li>
<li><p>A deletion test</p></li>
<li><p>An idempotent creation test</p></li>
<li><p>An idempotent update test</p></li>
<li><p>An idempotent deletion test</p></li>
</ul>
<p>You are unlikely to find all of these tests for every module that exists, but it is still a goal
of module development to produce this minimum set of tests.</p>
<p>Below is the implementation of a creation test.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_create_policy_rule_no_existence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">set_module_args</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rule1&quot;</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="s1">&#39;present&#39;</span><span class="p">,</span>
        <span class="n">policy</span><span class="o">=</span><span class="s1">&#39;policy1&#39;</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
                <span class="n">pool</span><span class="o">=</span><span class="s1">&#39;baz&#39;</span>
            <span class="p">)</span>
        <span class="p">],</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;http_uri&#39;</span><span class="p">,</span>
                <span class="n">path_begins_with_any</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;/ABC&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">],</span>
        <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="n">server</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">user</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span>
    <span class="p">))</span>

    <span class="n">module</span> <span class="o">=</span> <span class="n">AnsibleModule</span><span class="p">(</span>
        <span class="n">argument_spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">argument_spec</span><span class="p">,</span>
        <span class="n">supports_check_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">supports_check_mode</span>
    <span class="p">)</span>

    <span class="c1"># Override methods to force specific logic in the module to happen</span>
    <span class="n">mm</span> <span class="o">=</span> <span class="n">ModuleManager</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">mm</span><span class="o">.</span><span class="n">exists</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mm</span><span class="o">.</span><span class="n">publish_on_device</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mm</span><span class="o">.</span><span class="n">draft_exists</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mm</span><span class="o">.</span><span class="n">_create_existing_policy_draft_on_device</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mm</span><span class="o">.</span><span class="n">create_on_device</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">exec_module</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;changed&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
</pre></div>
</div>
<p>The basic design of a test follows these steps:</p>
<ul class="simple">
<li><p>Define some parameters using <code class="docutils literal notranslate"><span class="pre">set_module_args</span></code></p></li>
<li><p>Create an instance of <code class="docutils literal notranslate"><span class="pre">AnsibleModule</span></code></p></li>
<li><p>Create an instance of <code class="docutils literal notranslate"><span class="pre">ModuleManager</span></code></p></li>
<li><p>Stub out all of the methods that communicate with the API using simple <code class="docutils literal notranslate"><span class="pre">Mock</span></code> classes</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">exec_module</span></code> to drive the test</p></li>
<li><p>Assert changes on the result</p></li>
</ul>
<p>Most of the above is self-explanatory, but the fourth item on the list warrants some explanation.</p>
<p>The purpose of the F5 Ansible module unit tests is to confirm that:</p>
<ul class="simple">
<li><p>a series of arguments</p></li>
<li><p>invokes a known series of methods</p></li>
<li><p>to produce a known result</p></li>
</ul>
<p>That’s it. There is noneed to mock the actual API calls. The best way to test actual API calls is via functional tests.</p>
<p>Therefore, to put it simply, the F5 module unit tests are there to test drive code
execution paths.</p>
<p>Using the above as an example, given the parameters that are set, if the <a href="#id1"><span class="problematic" id="id2">``</span></a>Mock``ed calls are
called during execution of the module, then the module will logically return the asserted
result.</p>
<p>If, however, there is a problem in the logic of the module such that a different code path
is taken than expected, then <code class="docutils literal notranslate"><span class="pre">pytest</span></code> will fail because it will attempt to call an API
method. This failure should pique your interest because it means there is a bug in the module.</p>
<p>So, one last time, unit tests are meant to confirm code path execution. Nothing more.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This section introduced you to tests, showed how and where they are laid out, and introduced
you to writing two forms of test: a <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> test and a <code class="docutils literal notranslate"><span class="pre">ModuleManager</span></code> test. With these
tools, the remainder of the work falls on the shoulders of the developer. Ansible <strong>will</strong>
run these tests as part of their basic test suite. Therefore, it is important that they are:</p>
<ul class="simple">
<li><p>Correct</p></li>
<li><p>Fast</p></li>
</ul>
<p>There are <em>hundreds</em>, if not <em>thousands</em>, of tests. If the F5 unit tests are slowing down the
total execution time of the test suite (beyond reason of course) then this should be
considered a bug and fixed.</p>
<p>In the next section, the concept of integration tests will be explored in greater depth.
Integration tests are the most important tests that can be run because they confirm or reject
the correctness of a module.</p>
</div>
</div>


    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../../_static/js/bootstrap.min.js"></script>
  <script src="../../../_static/js/clouddocs.js"></script>
  </body>
</html>