<!DOCTYPE html>
<div id="clouddocs-header">
  <div class="container-fluid">
    <div class="row corp-header">
      <div class="container corp-header">
        <div class="container corp-menu">
          <ul>
            <li><a href="https://f5.com" class="internalLink">F5.com</a></li>
            <li><a href="https://github.com/F5Networks" class="externalLink">GitHub</a></li>
            <li><a href="https://devcentral.f5.com" class="internalLink">Devcentral</a></li>
            <li><a href="https://support.f5.com" class="internalLink">Support</a></li>
          </ul>
        </div>
      </div>
    </div>

    <script async="async"
      src="https://consent.trustarc.com/notice?domain=f5.com&amp;c=teconsent&amp;text=true&amp;gtm=1" crossorigin=""
      id="truste_0.12182038258598205"></script>

    <div class="row pageHeader">
      <div class="container stat">
        <div class="col-xs-12 stat">
          <a class="internalLink" href="https://f5.com">
            <img class="logo" src="https://cdn.f5.com/websites/support/assets/images/logo.svg" width="50" height="44"
              alt="F5 Networks" title="F5 Networks" border="0">
          </a>
          <ul id="MainMenu" class="main-menu">
            <li data-submenu-id="products">
              <a data-link-type="nav: main" href="#" class="currentURL">Products
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="products-submenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h">BIG-IP Extensibility</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-extension/latest" data-link-type="Nav: Mega">F5
                            Application Services Extension 3</a></li>
                        <li><a href="https://clouddocs.f5.com/products/agc/latest" data-link-type="Nav: Mega">BIG-IP APM Access Guided
                            Configuration</a></li>
                        <li><a href="https://clouddocs.f5.com/products/iapp/iapp-lx/latest" data-link-type="Nav: Mega">iApps LX/iControl LX</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-declarative-onboarding/latest"
                            data-link-type="Nav: Mega">F5 Declarative Onboarding</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-telemetry-streaming/latest" data-link-type="Nav: Mega">F5
                            Telemetry Streaming</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-cloud-failover/latest" data-link-type="Nav: Mega">F5 Cloud
                            Failover</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-templates/latest/" data-link-type="Nav: Mega">F5
                            Application Services Templates</a></li>
                      </ul>
                    </li>


                    <li class="divider"></li>
                    <li><span class="a-mm-h">Container Ingress Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/" data-link-type="Nav: Mega">F5 BIG-IP Controller for
                            Kubernetes/OpenShift</a></li>
                      </ul>
                      <span class="a-mm-h">Network Function Virtualization</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/nfv/latest" data-link-type="Nav: Mega">F5 VNF Manager</a></li>
                      </ul>
                      <span class="a-mm-h">SDK</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-cli" target="_blank">F5 CLI</a></li>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-sdk-python" target="_blank">F5 SDK Python</a></li>
                      </ul>
                    </li>



                    <li class="divider"></li>
                    <li>
                      <span class="a-mm-h">OpenStack</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/openstack/agent/latest" data-link-type="Nav: Mega">F5 Agent - OpenStack
                            Neutron</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/lbaasv2-driver/latest" data-link-type="Nav: Mega">F5 Driver -
                            OpenStack LBaaS</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/heat-plugins/latest" data-link-type="Nav: Mega">F5 Plugins -
                            OpenStack Heat</a></li>
                      </ul>

                      <span class="a-mm-h">Ecosystems Integrations</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/f5-aci-servicecenter/latest" data-link-type="Nav: Mega">F5 ACI ServiceCenter</a>
                        </li>
                      </ul>


                    </li>
                    <li class="divider"></li>
                    <li><span class="a-mm-h">Orchestration</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/ansible/devel" target="_blank">F5 Modules for Ansible</a>
                        </li>
                        <li><a href="https://github.com/F5Networks/f5-aws-cloudformation" target="_blank"
                            class="externalLink">F5 Templates for AWS CloudFormation</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-azure-arm-templates" target="_blank"
                            class="externalLink">F5 Templates for Azure ARM</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-google-gdm-templates" target="_blank"
                            class="externalLink">F5 Templates for Google Cloud Deployment Manager</a> (GitHub)</li>
                        <li><a href="https://clouddocs.f5.com/products/templates/openstack-heat/latest" data-link-type="Nav: Mega">F5 Templates
                            for OpenStack Heat</a></li>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/terraform/latest/" data-link-type="Nav: Mega">F5 Resources
                            for Terraform Provider</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>

            <!--- NEW -->
            <li>
              <a href="#" class="currentURL">APIs
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="APISubmenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/big-iq/mgmt-api/latest/" data-link-type="Nav: Mega">F5 BIG-IQ API</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/api/iapps/">F5 BIG-IP iApps</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules">F5 BIG-IP iRules API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules-lx">F5 BIG-IP iRulesLX API</a></li>
                      </ul>
                    </li>

                    <li class="divider"></li>

                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-rest">F5 BIG-IP iControlREST API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-soap/">F5 BIG-IP iControl API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/ihealth/">F5 iHealth API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/tmsh">F5 tmsh scripting API</a></li>
                      </ul>
                    </li>

                  </ul>
                </div>
              </div>
            </li>




            <li>
              <a href="#" class="currentURL">Cloud &amp; Container
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="ContainersSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third"><span class="a-mm-h">Cloud Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GS-About.html"
                            data-link-type="Nav: Mega">Get Started</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Beacon-About.html"
                            data-link-type="Nav: Mega">Beacon</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-DNS-About.html"
                            data-link-type="Nav: Mega">DNS Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GSLB-About.html"
                            data-link-type="Nav: Mega">DNS Load Balancer Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Essential.App.Protect-About.html"
                            data-link-type="Nav: Mega">Essential App Protect Service</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Clouds</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/aws_index.html" data-link-type="Nav: Mega">AWS</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/azure_index.html" data-link-type="Nav: Mega">Azure</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/google_index.html" data-link-type="Nav: Mega">Google Cloud</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/cloud/openstack/" data-link-type="Nav: Mega">OpenStack</a></li>
                      </ul>
                      <!-- unnecessary right now>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/cloud/">See all </a></span>
                    <-->
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Containers</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/kubernetes/" data-link-type="Nav: Mega">Kubernetes</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/openshift/" data-link-type="Nav: Mega">OpenShift</a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li>
              <a href="#" class="currentURL">Resources
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="UPCProgramSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third">
                      <span class="a-mm-h">Downloads</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://hub.docker.com/r/f5networks/"
                            class="internalLink externalLink">Docker Hub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega"
                            href="https://store.docker.com/images/f5networks-asp"
                            class="internalLink externalLink">Docker Store</a></li>
                      </ul>
                      <span class="a-mm-h">OpenSource</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5Networks"
                            class="internalLink externalLink">F5Networks on GitHub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5DevCentral"
                            class="internalLink externalLink">F5DevCentral on GitHub</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third">
                      <span class="a-mm-h">Training &amp; Labs</span>
                      <ul>
                        <li>
                          <p>Learn how to get the most out of the F5 platform</p>
                        </li>
                        <li><a href="https://clouddocs.f5.com/training/community">Community</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>

                    <li class="third">
                      <a href="//university.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega">F5 University</a>
                      <ul>
                        <li>
                          <p>Get up to speed with free self-paced courses</p>
                        </li>
                      </ul>
                      <a data-ng-href="https://devcentral.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega" href="https://devcentral.f5.com">DevCentral</a>
                      <ul>
                        <li>
                          <p>Join the community of 250,000+ technical peers</p>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="col-xs-12 stat">
          <div class="topLinks">
            <span class="glyphicon glyphicon-search upc-search" id="search-toggle" style="display: none;"></span>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- /container-fluid -->
</div>
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detecting Configuration Differences &#8212; F5 Digital Customer Engagement Center 0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="dismiss">
      <button type="button" class="btn btn-info navbar-btn site-hidden">
        <i class="fa fa-align-justify"></i>
      </button>
    </div>
    <div id="sidebar" class="section-nav">
      
      <nav class="nav-sidebartoc">

        
        <h5>F5 Digital Customer Engagement Center 0.1 </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <h5>Current Page</h5>
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Detecting Configuration Differences</a><ul>
<li><a class="reference internal" href="#difference-class-implementation">Difference class implementation</a></li>
<li><a class="reference internal" href="#the-common-methods">The common methods</a><ul>
<li><a class="reference internal" href="#the-init-method">The __init__ method</a></li>
<li><a class="reference internal" href="#the-compare-method">The compare method</a></li>
<li><a class="reference internal" href="#the-default-method">The __default method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-change-is-affected">How change is affected</a></li>
<li><a class="reference internal" href="#complex-comparison">Complex comparison</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

         </span>
        <hr>
        <h5>Site Contents</h5>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/getting_started.html">Getting started</a></li>
</ul>
<p class="caption"><span class="caption-text">Solutions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/delivery/delivery_index.html">Application Delivery controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/security/security_index.html">Security</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-involved.html">How to get involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">Guidelines</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>

  
  <div class="main active" id="content">
    <article class="docs-container site-article-inner">
            <nav class="site-breadcrumb-nav site-nav">
          <ul class="site-breadcrumb-list">
            <li class="breadcrumb-item"><button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn site-hidden"><i class="fa fa-align-justify"></i></button>&#x20 <a href="/">CloudDocs Home</a> &gt; <a href="../../../index.html">F5 Digital Customer Engagement Center </a> &gt; Detecting Configuration Differences</li>
          </ul>
      </nav>
      

    
  <div class="section" id="detecting-configuration-differences">
<h1>Detecting Configuration Differences<a class="headerlink" href="#detecting-configuration-differences" title="Permalink to this headline">¶</a></h1>
<p>When it comes to deciding what changes to make to a remote BIG-IP, the majority of the job
falls on the shoulders of the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class (or suite of <code class="docutils literal notranslate"><span class="pre">Difference</span></code> classes).
Rectifying an existing config with a provided config can be the most difficult
part of module development.</p>
<p>This section explores the implementation of the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class that is used for the
module we’ve been working with. We’ll also see the module execution that leads up to the
usage of the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class.</p>
<p>You may hear the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class referred to as the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> “engine.”</p>
<div class="section" id="difference-class-implementation">
<h2>Difference class implementation<a class="headerlink" href="#difference-class-implementation" title="Permalink to this headline">¶</a></h2>
<p>The implementation for the module under <a class="reference external" href="https://github.com/F5Networks/f5-ansible/blob/stable-2.5/library/bigip_policy_rule.py#L522">development begins here</a>. Open this content in a new tab
and begin re-implementing it in the module under development.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class will be comparing the <em>internal module</em> representations of the
attributes you are interested in. Therefore, it is the <em>output</em> of the different adapter
classes. Keep this in mind.</p>
<p>What follows is a deeper dive into the components that make up the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class.</p>
</div>
<div class="section" id="the-common-methods">
<h2>The common methods<a class="headerlink" href="#the-common-methods" title="Permalink to this headline">¶</a></h2>
<p>This <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class includes a couple of common methods. The base <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class
is capable of doing simple, non-typed, key/value comparisons. If this satisfies all of your
needs, then you do not need to implement any further code in this class.</p>
<div class="section" id="the-init-method">
<h3>The __init__ method<a class="headerlink" href="#the-init-method" title="Permalink to this headline">¶</a></h3>
<p>The first method that a developer will encounter is the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method. There is no
need to change any of the code in this method.</p>
<p>The purpose of the method is to initialize a <code class="docutils literal notranslate"><span class="pre">Difference</span></code> object from the class itself.
There is a well-defined set of work that this method does, respective to this class. In
particular, it sets two instance variables to the values that are passed to the class.</p>
<p>The variables are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">self.want</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.have</span></code></p></li>
</ul>
<p>These names should be familiar, as they are the same <code class="docutils literal notranslate"><span class="pre">self.want</span></code> and <code class="docutils literal notranslate"><span class="pre">self.have</span></code> that
are used throughout the <code class="docutils literal notranslate"><span class="pre">ModuleManager</span></code> class that was explored earlier. When used in the
<code class="docutils literal notranslate"><span class="pre">Difference</span></code> class, these methods will be the conduit from which you will do comparisons.</p>
</div>
<div class="section" id="the-compare-method">
<h3>The compare method<a class="headerlink" href="#the-compare-method" title="Permalink to this headline">¶</a></h3>
<p>This method is responsible for deciding whether a comparison should be done by using predefined properties or the default comparison method.</p>
<p>The default comparison method is a simple <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">foo</span> <span class="pre">!=</span> <span class="pre">bar:</span> <span class="pre">return</span> <span class="pre">foo</span></code> comparison. It does
not take into consideration things like datatypes, where a comparison such as the one done
above might fail.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This underscores an important point about the earlier adapter patterns that were discussed
in the <code class="docutils literal notranslate"><span class="pre">ApiParameters</span></code> and <code class="docutils literal notranslate"><span class="pre">ModuleParameters</span></code> classes. When writing the properties in
these methods, it is imperative that you take comparison into consideration. Doing simple
things like sorting or type casting your return values can go a <strong>long</strong> way in minimizing
the problems you would otherwise have when implementing the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class.</p>
</div>
<p>For more complex comparisons, implement your own comparison method instead of using the default method. To do this, follow the same methodology that you
followed when writing the <code class="docutils literal notranslate"><span class="pre">ApiParameters</span></code> and <code class="docutils literal notranslate"><span class="pre">ModuleParameters</span></code> adapters: using the
<code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> decorator on methods.</p>
<p>You can see this implementation at work in the following method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diff_complex_items</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conditions_missing_default_rule_for_asm</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">F5ModuleError</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;all_traffic&#39; condition is required when using an ASM policy in a rule&#39;s &#39;enable&#39; action.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The above method is concerned with comparing a non-trivial comparison of the <code class="docutils literal notranslate"><span class="pre">actions</span></code>
property of the <code class="docutils literal notranslate"><span class="pre">ApiParameters</span></code> and <code class="docutils literal notranslate"><span class="pre">ModuleParameters</span></code> classes. Its implementation
looks pretty simple because most of the heavy lifting is done in other functions. The basic
idea though should drive the point home.</p>
</div>
<div class="section" id="the-default-method">
<h3>The __default method<a class="headerlink" href="#the-default-method" title="Permalink to this headline">¶</a></h3>
<p>This method is the fallback method that is called in the event that there is no user-defined
method with a <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> decorator that matches the property being compared. This
fallback method allows you to avoid common situations involving comparison. For example,
consider the comparison of one description to another. This is clearly a simple task and,
therefore, does not need to have a customer <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> decorated method written for it.</p>
</div>
</div>
<div class="section" id="how-change-is-affected">
<h2>How change is affected<a class="headerlink" href="#how-change-is-affected" title="Permalink to this headline">¶</a></h2>
<p>How does the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class affect what is returned and used by the module when
updating an API? The answer to that has three components.</p>
<p>First, the return value of any <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> decorated method in the <code class="docutils literal notranslate"><span class="pre">Difference</span></code>
class should return the value for the API attribute that it wants to change. Any value
these methods return is considered by the Ansible module to be <strong>the</strong> value for the
attribute in the API. The only exception is <code class="docutils literal notranslate"><span class="pre">None</span></code>. If you return <code class="docutils literal notranslate"><span class="pre">None</span></code>,
then the API attribute will be filtered out from any further operations.</p>
<p>The second part of the tool chain is handled by the <code class="docutils literal notranslate"><span class="pre">_update_changed_options</span></code> method
of the <code class="docutils literal notranslate"><span class="pre">ModuleManager</span></code>. This method initiates the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> object, and also is
responsible for making the calls to <code class="docutils literal notranslate"><span class="pre">compare</span></code> to compare. There is a fragment of the
<code class="docutils literal notranslate"><span class="pre">_update_changed_options</span></code> code that is responsible for checking the return value of the
<code class="docutils literal notranslate"><span class="pre">compare</span></code> method. The behavior is defined as such:</p>
<ul class="simple">
<li><p>If the returned value is a <code class="docutils literal notranslate"><span class="pre">dict</span></code>, then merge it into the dictionary of <code class="docutils literal notranslate"><span class="pre">changed</span></code> properties</p></li>
<li><p>Else, set the <code class="docutils literal notranslate"><span class="pre">changed</span></code> dictionary at key <code class="docutils literal notranslate"><span class="pre">k</span></code> to the returned value.</p></li>
</ul>
<p>This behavior implies that you are able to change <em>multiple</em> properties
with a single return value. Furthermore, you can return properties that are not even named
after the key being compared.</p>
<p>Consider the following:</p>
<p><strong>Simple return</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Difference</span>
<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;foo&quot;</span>
</pre></div>
</div>
<p>The above example would result in a <code class="docutils literal notranslate"><span class="pre">changed</span></code> dictionary that looks like this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">changed</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Dictionary return</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Difference</span>
<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
       <span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span>
       <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="s1">&#39;5678&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The above example would result in a <code class="docutils literal notranslate"><span class="pre">changed</span></code> dictionary that looks like this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">changed</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span>
   <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="s1">&#39;5678&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The third part of the tool change is the <code class="docutils literal notranslate"><span class="pre">UsableChanges</span></code> class. This will be discussed
further in later sections.</p>
</div>
<div class="section" id="complex-comparison">
<h2>Complex comparison<a class="headerlink" href="#complex-comparison" title="Permalink to this headline">¶</a></h2>
<p>For any situation in which the comparison of properties is more complicated than <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">y</span></code>,
the module developer will definitely need to implement their own comparison check.</p>
<p>Consider a property that contains dictionaries. In Python, it is not possible to compare two
dictionaries in their native state. The reason is because dictionaries inherently
have no order.</p>
<p>To perform this comparison, a <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> should be defined in the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class.
The name of the <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> must match the name of the property being compared, as shown in
earlier sections.</p>
<p>It is then the responsibility of the module developer to figure out how to carry out the
differentiation between the two values. Below is a comparison of two dicts
and other comparisons to take into consideration when diff’ing two values.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">records</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># External data groups are compared by their checksum, not their records. This</span>
    <span class="c1"># is because the BIG-IP does not store the actual records in the API. It instead</span>
    <span class="c1"># stores the checksum of the file. External DGs have the possibility of being huge</span>
    <span class="c1"># and we would never want to do a comparison of such huge files.</span>
    <span class="c1">#</span>
    <span class="c1"># Therefore, comparison is no-op if the DG being worked with is an external DG.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">internal</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">records</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">records</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">records</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">records</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">compare_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</td></tr></table></div>
<p>This comparison in particular comes from the <code class="docutils literal notranslate"><span class="pre">bigip_data_group</span></code> module. Let’s take a moment
to go line-by-line through the comparison. This will be a good opportunity to get a sense of
what can, and should, be done in a comparison method.</p>
<p>Ignore the comments at the top and begin at line 9.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">internal</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</pre></div>
</div>
<p>This comparison function begins by checking a <code class="docutils literal notranslate"><span class="pre">self.want</span></code> variable. In this module’s case,
the reason is described in the comment block above the comparison. Remember that
<code class="docutils literal notranslate"><span class="pre">self.want</span></code> is the data that the user provided to the Ansible module.</p>
<p>Line 10 brings you to a feature of the <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class’s properties.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<p>By returning <code class="docutils literal notranslate"><span class="pre">None</span></code>, the particular property will not be made available to the
<code class="docutils literal notranslate"><span class="pre">UsableChanges</span></code> class (and, subsequently, won’t be sent to the API). The lesson here is that
you should return <code class="docutils literal notranslate"><span class="pre">None</span></code> when there is <strong>no change</strong> in the values being compared.</p>
<p>Line 11 contains another comparison, but this comparison is done for a completely different
reason.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">records</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">records</span> <span class="o">==</span> <span class="p">[]:</span>
</pre></div>
</div>
<p>This comparison checks to see if there are:</p>
<ul class="simple">
<li><p>No existing records</p></li>
<li><p>No records specified by the user to the module</p></li>
</ul>
<p>The equality check with an empty list (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) may be a bit confusing. The reason for a comparison
like this is because the <code class="docutils literal notranslate"><span class="pre">`ModuleParameters</span></code> returns an empty list when the user specifies
a single empty item in the Ansible module. For example, something like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">records</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>This allows the user of the module to zero out the values of records. So this comparison is
essentially checking that there are no existiing records, and that the user specified a single
empty record. Therefore, a no-op, or no change, and the comparison returns what is seen on line
12: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>On line 13, there is a shortcut in logic for this comparison method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">records</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>
</div>
<p>The shortcut is that, if the module has reached this point, and there are no existing records,
no comparison even needs to take place, just return whatever the user specified to the module.</p>
<p>This is a common operation to make when checking parameter difference. There is no reason to
do a comparison in this case because there are no existing records to compare with. The current
order of <code class="docutils literal notranslate"><span class="pre">if</span></code> statements to get to this point though, is important. Line 14 is the shortcut
in practice, returning what the user wants.</p>
<p>Finally, on line 15, a serious comparison takes place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">compare_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
</pre></div>
</div>
<p>This line illustrates a true comparison of dictionaries. In this case, the module is using a
method called <code class="docutils literal notranslate"><span class="pre">compare_dictionary</span></code>, found in <code class="docutils literal notranslate"><span class="pre">ansible.module_utils.network.f5.common</span></code>.
This method allows you to compare dictionaries to find out if there are the same
or different.</p>
<p>Finally, the method here returns the return value from the <code class="docutils literal notranslate"><span class="pre">compare_dictionary</span></code> function.
For your information, the return value is the content of <code class="docutils literal notranslate"><span class="pre">self.want</span></code> for the property being
compared. In this case, the records the user <em>wants</em> will be returned if the
two values differ.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Difference</span></code> class is a core piece of functionality in the F5 Modules for Ansible. It is
responsible for much of the heavy lifting when doing an update of an existing resource. The work
it does, however, can be complicated and prone to error because of this complexity. It is
highly recommended that you utilize unit tests when working on your module’s own implementation.</p>
<p>You received a taste of what a more complicated comparison looks like. Future modules will surely
push the limits of what it means to be complicated when comparing values. Over time, it is
expected that patterns and common methods will emerge that makes the process of comparison much
easier for the lay-developer.</p>
<p>In the next section, we’ll touch upon the <code class="docutils literal notranslate"><span class="pre">Changes</span></code> classes that you will encounter in modules.</p>
</div>
</div>


    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../../_static/js/bootstrap.min.js"></script>
  <script src="../../../_static/js/clouddocs.js"></script>
  </body>
</html>