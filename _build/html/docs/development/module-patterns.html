<!DOCTYPE html>
<div id="clouddocs-header">
  <div class="container-fluid">
    <div class="row corp-header">
      <div class="container corp-header">
        <div class="container corp-menu">
          <ul>
            <li><a href="https://f5.com" class="internalLink">F5.com</a></li>
            <li><a href="https://github.com/F5Networks" class="externalLink">GitHub</a></li>
            <li><a href="https://devcentral.f5.com" class="internalLink">Devcentral</a></li>
            <li><a href="https://support.f5.com" class="internalLink">Support</a></li>
          </ul>
        </div>
      </div>
    </div>

    <script async="async"
      src="https://consent.trustarc.com/notice?domain=f5.com&amp;c=teconsent&amp;text=true&amp;gtm=1" crossorigin=""
      id="truste_0.12182038258598205"></script>

    <div class="row pageHeader">
      <div class="container stat">
        <div class="col-xs-12 stat">
          <a class="internalLink" href="https://f5.com">
            <img class="logo" src="https://cdn.f5.com/websites/support/assets/images/logo.svg" width="50" height="44"
              alt="F5 Networks" title="F5 Networks" border="0">
          </a>
          <ul id="MainMenu" class="main-menu">
            <li data-submenu-id="products">
              <a data-link-type="nav: main" href="#" class="currentURL">Products
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="products-submenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h">BIG-IP Extensibility</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-extension/latest" data-link-type="Nav: Mega">F5
                            Application Services Extension 3</a></li>
                        <li><a href="https://clouddocs.f5.com/products/agc/latest" data-link-type="Nav: Mega">BIG-IP APM Access Guided
                            Configuration</a></li>
                        <li><a href="https://clouddocs.f5.com/products/iapp/iapp-lx/latest" data-link-type="Nav: Mega">iApps LX/iControl LX</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-declarative-onboarding/latest"
                            data-link-type="Nav: Mega">F5 Declarative Onboarding</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-telemetry-streaming/latest" data-link-type="Nav: Mega">F5
                            Telemetry Streaming</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-cloud-failover/latest" data-link-type="Nav: Mega">F5 Cloud
                            Failover</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-templates/latest/" data-link-type="Nav: Mega">F5
                            Application Services Templates</a></li>
                      </ul>
                    </li>


                    <li class="divider"></li>
                    <li><span class="a-mm-h">Container Ingress Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/" data-link-type="Nav: Mega">F5 BIG-IP Controller for
                            Kubernetes/OpenShift</a></li>
                      </ul>
                      <span class="a-mm-h">Network Function Virtualization</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/nfv/latest" data-link-type="Nav: Mega">F5 VNF Manager</a></li>
                      </ul>
                      <span class="a-mm-h">SDK</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-cli" target="_blank">F5 CLI</a></li>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-sdk-python" target="_blank">F5 SDK Python</a></li>
                      </ul>
                    </li>



                    <li class="divider"></li>
                    <li>
                      <span class="a-mm-h">OpenStack</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/openstack/agent/latest" data-link-type="Nav: Mega">F5 Agent - OpenStack
                            Neutron</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/lbaasv2-driver/latest" data-link-type="Nav: Mega">F5 Driver -
                            OpenStack LBaaS</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/heat-plugins/latest" data-link-type="Nav: Mega">F5 Plugins -
                            OpenStack Heat</a></li>
                      </ul>

                      <span class="a-mm-h">Ecosystems Integrations</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/f5-aci-servicecenter/latest" data-link-type="Nav: Mega">F5 ACI ServiceCenter</a>
                        </li>
                      </ul>


                    </li>
                    <li class="divider"></li>
                    <li><span class="a-mm-h">Orchestration</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/ansible/devel" target="_blank">F5 Modules for Ansible</a>
                        </li>
                        <li><a href="https://github.com/F5Networks/f5-aws-cloudformation" target="_blank"
                            class="externalLink">F5 Templates for AWS CloudFormation</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-azure-arm-templates" target="_blank"
                            class="externalLink">F5 Templates for Azure ARM</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-google-gdm-templates" target="_blank"
                            class="externalLink">F5 Templates for Google Cloud Deployment Manager</a> (GitHub)</li>
                        <li><a href="https://clouddocs.f5.com/products/templates/openstack-heat/latest" data-link-type="Nav: Mega">F5 Templates
                            for OpenStack Heat</a></li>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/terraform/latest/" data-link-type="Nav: Mega">F5 Resources
                            for Terraform Provider</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>

            <!--- NEW -->
            <li>
              <a href="#" class="currentURL">APIs
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="APISubmenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/big-iq/mgmt-api/latest/" data-link-type="Nav: Mega">F5 BIG-IQ API</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/api/iapps/">F5 BIG-IP iApps</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules">F5 BIG-IP iRules API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules-lx">F5 BIG-IP iRulesLX API</a></li>
                      </ul>
                    </li>

                    <li class="divider"></li>

                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-rest">F5 BIG-IP iControlREST API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-soap/">F5 BIG-IP iControl API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/ihealth/">F5 iHealth API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/tmsh">F5 tmsh scripting API</a></li>
                      </ul>
                    </li>

                  </ul>
                </div>
              </div>
            </li>




            <li>
              <a href="#" class="currentURL">Cloud &amp; Container
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="ContainersSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third"><span class="a-mm-h">Cloud Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GS-About.html"
                            data-link-type="Nav: Mega">Get Started</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Beacon-About.html"
                            data-link-type="Nav: Mega">Beacon</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-DNS-About.html"
                            data-link-type="Nav: Mega">DNS Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GSLB-About.html"
                            data-link-type="Nav: Mega">DNS Load Balancer Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Essential.App.Protect-About.html"
                            data-link-type="Nav: Mega">Essential App Protect Service</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Clouds</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/aws_index.html" data-link-type="Nav: Mega">AWS</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/azure_index.html" data-link-type="Nav: Mega">Azure</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/google_index.html" data-link-type="Nav: Mega">Google Cloud</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/cloud/openstack/" data-link-type="Nav: Mega">OpenStack</a></li>
                      </ul>
                      <!-- unnecessary right now>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/cloud/">See all </a></span>
                    <-->
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Containers</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/kubernetes/" data-link-type="Nav: Mega">Kubernetes</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/openshift/" data-link-type="Nav: Mega">OpenShift</a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li>
              <a href="#" class="currentURL">Resources
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="UPCProgramSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third">
                      <span class="a-mm-h">Downloads</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://hub.docker.com/r/f5networks/"
                            class="internalLink externalLink">Docker Hub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega"
                            href="https://store.docker.com/images/f5networks-asp"
                            class="internalLink externalLink">Docker Store</a></li>
                      </ul>
                      <span class="a-mm-h">OpenSource</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5Networks"
                            class="internalLink externalLink">F5Networks on GitHub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5DevCentral"
                            class="internalLink externalLink">F5DevCentral on GitHub</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third">
                      <span class="a-mm-h">Training &amp; Labs</span>
                      <ul>
                        <li>
                          <p>Learn how to get the most out of the F5 platform</p>
                        </li>
                        <li><a href="https://clouddocs.f5.com/training/community">Community</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>

                    <li class="third">
                      <a href="//university.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega">F5 University</a>
                      <ul>
                        <li>
                          <p>Get up to speed with free self-paced courses</p>
                        </li>
                      </ul>
                      <a data-ng-href="https://devcentral.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega" href="https://devcentral.f5.com">DevCentral</a>
                      <ul>
                        <li>
                          <p>Join the community of 250,000+ technical peers</p>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="col-xs-12 stat">
          <div class="topLinks">
            <span class="glyphicon glyphicon-search upc-search" id="search-toggle" style="display: none;"></span>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- /container-fluid -->
</div>
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Design patterns &#8212; F5 Digital Customer Engagement Center 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="dismiss">
      <button type="button" class="btn btn-info navbar-btn site-hidden">
        <i class="fa fa-align-justify"></i>
      </button>
    </div>
    <div id="sidebar" class="section-nav">
      
      <nav class="nav-sidebartoc">

        
        <h5>F5 Digital Customer Engagement Center 0.1 </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <h5>Current Page</h5>
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Design patterns</a><ul>
<li><a class="reference internal" href="#crudable">CRUDable</a></li>
<li><a class="reference internal" href="#only-updatable">Only Updatable</a></li>
<li><a class="reference internal" href="#executable">Executable</a></li>
<li><a class="reference internal" href="#crudable-reference">CRUDable Reference</a></li>
<li><a class="reference internal" href="#list-item-as-member">List item as member</a></li>
<li><a class="reference internal" href="#class-variables">Class variables</a><ul>
<li><a class="reference internal" href="#updatables">updatables</a></li>
<li><a class="reference internal" href="#api-attributes">api_attributes</a></li>
<li><a class="reference internal" href="#returnables">returnables</a></li>
<li><a class="reference internal" href="#api-map">api_map</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-classes">Common classes</a></li>
<li><a class="reference internal" href="#exceptions-to-common-classes">Exceptions to common classes</a></li>
<li><a class="reference internal" href="#defaulting-to-none">Defaulting to None</a></li>
<li><a class="reference internal" href="#what-is-the-layer-of-property-decorators-all-about">What is the layer of &#64;property decorators all about?</a></li>
<li><a class="reference internal" href="#why-are-they-not-all-setters">Why are they not all setters?</a></li>
<li><a class="reference internal" href="#use-the-module-utils-test-suite-to-verify-ansiblef5parameters-classes">Use the module_utils test suite to verify AnsibleF5Parameters classes</a></li>
<li><a class="reference internal" href="#never-import">Never import *</a></li>
<li><a class="reference internal" href="#the-changes-class">The Changes class</a></li>
<li><a class="reference internal" href="#the-difference-class">The Difference class</a></li>
<li><a class="reference internal" href="#api-map-adapter">API Map Adapter</a></li>
<li><a class="reference internal" href="#to-1-adapter">1-to-1 Adapter</a></li>
</ul>
</li>
</ul>

         </span>
        <hr>
        <h5>Site Contents</h5>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/filing-issues.html">Filing issues</a></li>
</ul>
<p class="caption"><span class="caption-text">Solutions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../solutions/delivery/delivery_index.html">Application Delivery controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../solutions/security/security_index.html">Security</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-involved.html">How to get involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">Guidelines</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>

  
  <div class="main active" id="content">
    <article class="docs-container site-article-inner">
            <nav class="site-breadcrumb-nav site-nav">
          <ul class="site-breadcrumb-list">
            <li class="breadcrumb-item"><button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn site-hidden"><i class="fa fa-align-justify"></i></button>&#x20 <a href="/">CloudDocs Home</a> &gt; <a href="../../index.html">F5 Digital Customer Engagement Center </a> &gt; Design patterns</li>
          </ul>
      </nav>
      

    
  <div class="section" id="design-patterns">
<h1>Design patterns<a class="headerlink" href="#design-patterns" title="Permalink to this headline">¶</a></h1>
<p>These patterns should:</p>
<ul class="simple">
<li><p>Make your time spent developing new modules shorter</p></li>
<li><p>Allow you to not need to decide “what to do”</p></li>
<li><p>Allow for easier unit testing</p></li>
<li><p>Allow for customizing the modules to meet edge cases easier</p></li>
<li><p>Allow for customizing the modules to meet feature requests easier</p></li>
<li><p>Allow for customizing the modules to address bug reports easier</p></li>
</ul>
<p>If these patterns conflict with the above goals, the patterns should be re-evaluated and all modules changed to support the new patterns.</p>
<div class="section" id="crudable">
<h2>CRUDable<a class="headerlink" href="#crudable" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>bigip_static_route</p></li>
</ul>
</div>
<div class="section" id="only-updatable">
<h2>Only Updatable<a class="headerlink" href="#only-updatable" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>bigip_snmp</p></li>
</ul>
</div>
<div class="section" id="executable">
<h2>Executable<a class="headerlink" href="#executable" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>bigip_command</p></li>
</ul>
</div>
<div class="section" id="crudable-reference">
<h2>CRUDable Reference<a class="headerlink" href="#crudable-reference" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>iworkflow_tenant_connector</p></li>
</ul>
</div>
<div class="section" id="list-item-as-member">
<h2>List item as member<a class="headerlink" href="#list-item-as-member" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>bigip_remote_syslog</p></li>
</ul>
</div>
<div class="section" id="class-variables">
<h2>Class variables<a class="headerlink" href="#class-variables" title="Permalink to this headline">¶</a></h2>
<p>The following class variables are common attributes that each <cite>Parameters</cite> class needs to define.</p>
<div class="section" id="updatables">
<h3>updatables<a class="headerlink" href="#updatables" title="Permalink to this headline">¶</a></h3>
<p>Specifies a list of <cite>Parameters</cite> properties that the module considers updatable. Use this when doing <cite>should_update()</cite> comparisons and setting properties in <cite>self.changes</cite>.</p>
</div>
<div class="section" id="api-attributes">
<h3>api_attributes<a class="headerlink" href="#api-attributes" title="Permalink to this headline">¶</a></h3>
<p>Specifies a list <cite>Parameters</cite> properties to provide to the <cite>api_params()</cite> method when generating valid sets of attributes for resources in the REST API.</p>
<p>You will likely need to write adapter methods that call the properties used internally by the module. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">minSupportedBIGIPVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_bigip_version</span>
</pre></div>
</div>
<p>Use this method instead of the map method when the value in <cite>api_params()</cite> is not a single property but a set of properties that you need to combine.</p>
<p>The <cite>api_params</cite> method uses this to generate a valid set of attributes to provide to the REST API. Typically this dictionary does NOT provide the <cite>name</cite> and <cite>partition</cite> parameters.</p>
<p>You should specify these values specifically in the <cite>(create|update|delete)_on_device</cite> methods.</p>
</div>
<div class="section" id="returnables">
<h3>returnables<a class="headerlink" href="#returnables" title="Permalink to this headline">¶</a></h3>
<p>Specifies a list of Parameters properties for the <cite>to_return()</cite> method to iterate over when supplying “changed” options back to the user.</p>
</div>
<div class="section" id="api-map">
<h3>api_map<a class="headerlink" href="#api-map" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you cannot write the API parameters as methods. For example, the <cite>bigip_device_dns</cite> APIs parameters include:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dns</span><span class="o">.</span><span class="n">proxy</span><span class="o">.</span><span class="fm">__iter__</span>
</pre></div>
</div>
<p>This attribute is mapped to <cite>forwarders</cite> in the Ansible module.</p>
<p>The pattern is to use methods decorated as properties in Python and then to call those methods when setting values and getting values.</p>
<p>For example, you would map the <cite>dns.proxy.__iter__</cite> API attribute to the <cite>_values</cite> key “forwarders”. Normally you would set the API attributes directly in the dictionary. You would get those API-specific keys when you return the values to compare.</p>
<p>This makes the getters for the Module options look messy though.</p>
<p>You could make the API attributes have their own &#64;property decorators, but this won’t work in the “dns” case mentioned above.</p>
<p>NEED
a pattern for a single Ansible Option Parameter that returns 2 API attributes.
For example in the bigip_virtual_server module there is an option called
enabled vlans. This, however, actually sets two (possibly 3) values in the API:</p>
<ul class="simple">
<li><p><cite>vlans</cite> (list)</p></li>
<li><p><cite>vlansDisabled</cite> (boolean True)</p></li>
<li><p><cite>vlansEnabled</cite> (boolean True)</p></li>
</ul>
<p>what is a pattern that, that supports that?</p>
<p>The pattern is that the api_attributes is an arbitrary list of attributes that
you want to send to the API.</p>
<p>The api_params() method uses this list to iterate over the</p>
<p>param_api_map does not work for situations where the Ansible-&gt;API relationship
is 1-&gt;n (bigip_virtual_server with enabled_vlans) param_api_map only works
for 1-&gt;1</p>
<p>Requirements
- Easy attribute comparison in Ansible parameters format with BIG-IP API values
- Ability to consume API attributes that you cannot write as Python functions (dns.proxy.__iter__ for example)</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="n">params_spec</span><span class="o">=</span><span class="n">dict</span><span class="p">(</span>
         <span class="k">cache</span><span class="o">=</span><span class="s1">&#39;dns.cache&#39;</span><span class="p">,</span>
         <span class="n">forwarders</span><span class="o">=</span><span class="s1">&#39;dns.proxy.__iter__&#39;</span><span class="p">,</span>
         <span class="n">name_servers</span><span class="o">=</span><span class="s1">&#39;nameServers&#39;</span><span class="p">,</span>
         <span class="k">search</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span>
         <span class="n">ip_version</span><span class="o">=</span><span class="s1">&#39;include&#39;</span>
     <span class="p">)</span>

     <span class="n">updatables</span> <span class="o">=</span> <span class="p">[</span>
         <span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;forwarders&#39;</span><span class="p">,</span> <span class="s1">&#39;name_servers&#39;</span><span class="p">,</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="s1">&#39;ip_version&#39;</span>
     <span class="p">]</span>
 <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="common-classes">
<h2>Common classes<a class="headerlink" href="#common-classes" title="Permalink to this headline">¶</a></h2>
<p>Nearly every module (see exceptions) should have the following classes. These classes support the stated design patterns.</p>
<ul class="simple">
<li><p>Parameters</p></li>
<li><p>Changes</p></li>
<li><p>Difference</p></li>
<li><p>ModuleManager</p></li>
<li><p>ArgumentSpec</p></li>
</ul>
</div>
<div class="section" id="exceptions-to-common-classes">
<h2>Exceptions to common classes<a class="headerlink" href="#exceptions-to-common-classes" title="Permalink to this headline">¶</a></h2>
<p>Exceptions to the above rules will happen when:</p>
<ul class="simple">
<li><p>The API that a particular module addresses changes between versions of the software.</p></li>
<li><p>The resources or collections that the module is manipulating become too numerous.</p></li>
</ul>
<p>Good examples of this include:</p>
<ul class="simple">
<li><p><cite>bigip_ssl_certificate</cite></p></li>
<li><p><cite>bigip_gtm_wide_ip</cite></p></li>
</ul>
</div>
<div class="section" id="defaulting-to-none">
<h2>Defaulting to None<a class="headerlink" href="#defaulting-to-none" title="Permalink to this headline">¶</a></h2>
<p>You should never specify default values in your <cite>ArgumentSpec</cite>. For example, the following is incorrect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span>
<span class="p">),</span>
</pre></div>
</div>
<p>But, shouldn’t you use the actual defaults?</p>
<p>Answer: No</p>
<p>You want to support cases where the user does not specify a value for a particular option. If that happens, then you should not step on that parameter if it is pre-configured.</p>
<p>If a user had a setting that they want to keep and you specified a default value, then the first time they forgot to specify that value, you would end up replacing that value with your default.</p>
<p>Ansible defaults <cite>required</cite> to <cite>False</cite> and <cite>default</cite> to <cite>None</cite>. Therefore, there is no need to specify these default values.</p>
</div>
<div class="section" id="what-is-the-layer-of-property-decorators-all-about">
<h2>What is the layer of &#64;property decorators all about?<a class="headerlink" href="#what-is-the-layer-of-property-decorators-all-about" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code> decorators represent an adapter pattern. Inside the <cite>ModuleManager</cite>, when you need to compare the data, these properties return that data in a known format.</p>
<p>The API’s resource attributes differ in structure and name from the options that a user can provide to a module.</p>
<p>For example, an API resource may have an attribute called <cite>minSupportedBIGIPVersion</cite>. However, the user-facing portion of the module may refer to this attribute as <cite>min_bigip_version</cite>.</p>
<p>You should do this because:</p>
<ul class="simple">
<li><p>It provides an abstraction of the API so the name of the thing you’re modifying is not closely tied to the implementation of the API.</p></li>
<li><p>Many times the API attribute names are vague, and this abstraction makes them more clear.</p></li>
<li><p>The Resource Attributes use camelCase variable naming, while some of Python and nearly all of Ansible use snake_case variable naming.</p></li>
</ul>
<p>For clarity’s sake, all of the attributes are typically compared by the option name in Ansible and not the Resource attribute name.</p>
<p>This allows you to look at the names of variables and match them to the names of the options in the Ansible module.</p>
<p>While the names of properties usually mirror the names of the module options available to the user, the values of those properties do not.</p>
<p>Values of the properties reflect the values that the API resource accepts. This is because, ultimately, the values you need to deal with are the values that will update the API.</p>
<p>Therefore, when you receive options from the module, you transform them into the values that would appropriate for the API. When you receive values from the API, you might order them or cast some of their values to specific types so that comparisons can occur, but otherwise you don’t really touch them.</p>
<ol class="arabic simple">
<li><p>The property name reflects module option.</p></li>
<li><p>The property getter reflects the appropriate Resource attribute value.</p></li>
</ol>
</div>
<div class="section" id="why-are-they-not-all-setters">
<h2>Why are they not all setters?<a class="headerlink" href="#why-are-they-not-all-setters" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you do not know ahead of time what the value of that property should be. Often you must set two or more options before you can know the value of another option.</p>
<p>Consider a module that accepts an IP address option and a gateway mask option, but needs to return a CIDR representation of those two values. Without getting both values, you cannot produce the one value.</p>
<p>That is why you calculate the necessary value at time of <cite>getattr</cite>, and not at the time of <cite>setattr</cite>.</p>
</div>
<div class="section" id="use-the-module-utils-test-suite-to-verify-ansiblef5parameters-classes">
<h2>Use the module_utils test suite to verify AnsibleF5Parameters classes<a class="headerlink" href="#use-the-module-utils-test-suite-to-verify-ansiblef5parameters-classes" title="Permalink to this headline">¶</a></h2>
<p>This is important in case there is a pattern you miss for adapting API attributes and module params.</p>
<p>This test suite is here:</p>
<ul class="simple">
<li><p>test/misc/test_module_utils.py</p></li>
</ul>
</div>
<div class="section" id="never-import">
<h2>Never import *<a class="headerlink" href="#never-import" title="Permalink to this headline">¶</a></h2>
<p>Most often, you do this because you are using one of the following variables:</p>
<ul class="simple">
<li><p><cite>BOOLEANS</cite></p></li>
<li><p><cite>BOOLEANS_TRUE</cite></p></li>
<li><p><cite>BOOLEANS_FALSE</cite></p></li>
</ul>
<p>It is, however, an anti-pattern to import from * and the Ansible unit tests will catch it. Instead, specifically include each thing that you want to use.</p>
</div>
<div class="section" id="the-changes-class">
<h2>The Changes class<a class="headerlink" href="#the-changes-class" title="Permalink to this headline">¶</a></h2>
<p>In many cases, the values that you process from the user will match the values that you send to BIG-IP.</p>
<p>For example, consider the following parameters:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">This is an example</span>
  <span class="nt">bigip_device_sshd</span><span class="p">:</span>
      <span class="nt">banner</span><span class="p">:</span> <span class="s">&quot;enabled&quot;</span>
      <span class="nt">banner_text</span><span class="p">:</span> <span class="s">&quot;banner</span><span class="nv"> </span><span class="s">text</span><span class="nv"> </span><span class="s">goes</span><span class="nv"> </span><span class="s">here&quot;</span>
      <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;1234&quot;</span>
      <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;secret&quot;</span>
      <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;lb.mydomain.com&quot;</span>
      <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;admin&quot;</span>
</pre></div>
</div>
<p>The module code that implements this is a collection of different adapters. Collectively, they allow the module to convert the information the user provides into a format that can the BIG-IP can receive and send.</p>
<p>By using this class, you can complete the cycle:</p>
<p>User (params) -&gt; Module -&gt; REST -&gt; Module -&gt; User (changed params)</p>
<p>Most of the adapters adapt data to meet the format expect by the REST API. Use the <cite>Changes</cite> class to adapt the data to meet the format expected by the end user.</p>
<p>If there is a need to change the value to something that is more “human” so that the user can understand it, that job is undertaken by the <cite>Changes</cite> module.</p>
<p>An example is the <cite>bigip_device_connectivity</cite> module, where it acts as a way to translate BIG-IP’s representation of “none” (<cite>any6</cite>) to the human word “none”.</p>
<p>Examples of modules that use the <cite>Changes</cite> class are:</p>
<ul class="simple">
<li><p><cite>bigip_gtm_datacenter</cite></p></li>
<li><p><cite>bigip_device_connectivity</cite></p></li>
<li><p><cite>bigip_device_group</cite></p></li>
</ul>
</div>
<div class="section" id="the-difference-class">
<h2>The Difference class<a class="headerlink" href="#the-difference-class" title="Permalink to this headline">¶</a></h2>
<p>When you compare values to detect changes, sometimes the default comparison method will not be appropriate. The default comparison method essentially just does a simple comparison.</p>
<p>The source of this method illustrates its simplicity:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">attr1</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="n">attr2</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="k">if</span> <span class="n">attr1</span> <span class="o">!=</span> <span class="n">attr2</span><span class="p">:</span>
    <span class="n">changed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr1</span>
</pre></div>
</div>
<p>As you can see, it is quite simple and does not take into consideration anything more complicated than simply comparing the values.</p>
<p>This difference is not conducive to more complicated data structures or types of data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span>
</pre></div>
</div>
<p>The above fails to satisfy this simple (albeit erroneous due to established patterns) difference.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is logically incorrect because the Adapter pattern you should use for the <cite>Parameters</cite> class mandates that <cite>&#64;property</cite> values return a specific data type (in the above case <cite>int</cite>) and should never be non-deterministic.</p>
</div>
<p>To check for differences in more complicated data structures, use of the <cite>Difference</cite> class.</p>
<p>The definition of the <cite>Difference</cite> class is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Difference</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="n">have</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">want</span> <span class="o">=</span> <span class="n">want</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">have</span> <span class="o">=</span> <span class="n">have</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__default</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="n">attr1</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">attr2</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr1</span> <span class="o">!=</span> <span class="n">attr2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">attr1</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attr1</span>
</pre></div>
</div>
<p>By default, it uses the simple comparison to diff the parameters provided, and discovered, by the module.</p>
<p>To make use of it, you must do the following.</p>
<p>First, define this class in your module.</p>
<p>Second, add <cite>&#64;property</cite> methods for each of the values you want to compare.</p>
<p>Remember, the properties of the <cite>Parameter</cite> classes are the names exposed to the module user and not the names of REST API parameters themselves (unless it perfectly matches), because the REST API camel-cases all parameter names.</p>
<p>To provide custom diffing for the <cite>members</cite> module parameter, you can add this as a <cite>&#64;property</cite> to the <cite>Difference</cite> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">members</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">members</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">members</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">append</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">members</span>

    <span class="c1"># Checking to see if the supplied list is a subset of the current</span>
    <span class="c1"># list is only relevant if user provides the `append` parameter</span>
    <span class="n">new_members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>
    <span class="n">current_members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_members</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">current_members</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="o">.</span><span class="n">members</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="o">.</span><span class="n">members</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>These <cite>&#64;property</cite> methods <strong>must</strong> be named after the Parameter you want to compare.</p>
<p>Additionally, the return value of these <cite>&#64;property</cite> definitions is one of two values.</p>
<ul class="simple">
<li><p>Python <cite>None</cite> if there is no difference.</p></li>
<li><p>The value of the difference if there is one. Later, the module reports this value as what changed when the module ran.</p></li>
</ul>
<p>Finally, to make use of this new difference class, you must change the following method in the <cite>ModuleManager</cite> code:</p>
<ul class="simple">
<li><p><cite>_update_changed_options</cite></p></li>
</ul>
<p>The new value of this method must include the usage of the <cite>Difference</cite> class as a new object. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_update_changed_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">Difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">want</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">have</span><span class="p">)</span>
    <span class="n">updatables</span> <span class="o">=</span>  <span class="n">Parameters</span><span class="o">.</span><span class="n">updatables</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">updatables</span><span class="p">:</span>
        <span class="n">change</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">changed</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">change</span>
    <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changes</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">changed</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="api-map-adapter">
<h2>API Map Adapter<a class="headerlink" href="#api-map-adapter" title="Permalink to this headline">¶</a></h2>
<p>This adapter pattern is useful for converting data values from user inputs to REST outputs.</p>
<p>The API Map Adapter pattern adapts a known REST attribute to a predefined <cite>Parameters</cite> method. The return value of this method is a correct payload for the REST attribute.</p>
<p>This pattern is frequently used so you can translate the input provided by the user into a format that the REST API can consume.</p>
<p>Here is an example of this kind of adapter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="n">api_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span>

    <span class="s1">&#39;bannerText&#39;</span><span class="p">:</span> <span class="s1">&#39;banner_text&#39;</span><span class="p">,</span>

    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="to-1-adapter">
<h2>1-to-1 Adapter<a class="headerlink" href="#to-1-adapter" title="Permalink to this headline">¶</a></h2>
<p>YAML represents the <cite>banner</cite> parameter as a simple key with a simple value. The actual REST payload contains an attribute called <cite>banner</cite> and it takes an actual value called <cite>enabled</cite>.</p>
<p>In code, the <cite>ArgumentSpec</cite> class represents this.</p>
<p>This is the most simple form of a parameter definition by the F5 Ansible modules because it is nearly a 1 to 1 translation of Ansible to F5.</p>
<p>The following is an example of this kind of adapter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
    <span class="n">banner_text</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">]</span>
    <span class="p">),</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>


    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  </body>
</html>